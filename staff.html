<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° transition ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Sidebar */
    .sidebar-text {
      transition: opacity 0.3s, transform 0.3s;
      white-space: nowrap;
    }
    .sidebar-collapsed .sidebar-text {
      opacity: 0;
      transform: translateX(-20px);
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ collapsed */
    }
  </style>
</head>
<body class="bg-red-900 flex ">

  <!-- Sidebar -->
  <aside id="sidebar" class="bg-yellow-500 h-screen p-5 flex flex-col transition-all duration-300 w-64">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏±‡∏ö/‡∏Ç‡∏¢‡∏≤‡∏¢ -->
    <button onclick="toggleSidebar()" class="mb-6 bg-yellow-300 p-2 rounded hover:bg-yellow-400">‚â°</button>

    <h1 class="text-xl font-bold mb-6 text-center sidebar-text">üç± Staff Menu</h1>
    <nav class="flex flex-col space-y-3">
      <button onclick="showSection('menu')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        ü•ò <span class="sidebar-text">‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('report')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        üí∞ <span class="sidebar-text">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
      </button>
      <button onclick="logout()" class="flex items-center gap-2 bg-red-500 text-white py-2 px-2 rounded hover:bg-red-600 mt-auto">
        üö™ <span class="sidebar-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
      </button>
    </nav>
  </aside>

  <!-- Main content -->
  <main id="mainContent" class="flex-1 p-6 transition-all duration-300">
    <!-- Section ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
    <section id="menuSection">
      <h2 class="text-2xl font-semibold mb-4">üçî ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
      <div id="menuContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- Section ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ -->
    <section id="reportSection" class="hidden"></section>
  </main>

  <!-- Order Summary -->
  <div id="orderSummary" class="fixed bottom-0 left-64 w-[calc(100%-16rem)] bg-white shadow-md border-t border-gray-200 p-4 hidden">
    <h2 class="text-lg font-semibold mb-2">üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
    <ul id="orderList" class="text-gray-700 mb-2"></ul>
    <p class="font-semibold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</p>
    <button onclick="submitOrder()" class="mt-2 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
  </div>

  <script>
    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
    let menuItems = JSON.parse(localStorage.getItem("menuData")) || [
      {id:1,name:"‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏´‡∏°‡∏π",price:69,img:"https://via.placeholder.com/100"},
      {id:2,name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå",price:39,img:"https://via.placeholder.com/100"},
      {id:3,name:"‡πÇ‡∏Ñ‡πâ‡∏Å 16oz",price:25,img:"https://via.placeholder.com/100"}
    ];

    let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];

    const menuContainer = document.getElementById("menuContainer");
    const orderSummary = document.getElementById("orderSummary");
    const orderList = document.getElementById("orderList");
    const totalDisplay = document.getElementById("total");
    let order = [];

    // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π
    function renderMenu() {
      menuContainer.innerHTML = "";
      if (menuItems.length === 0) {
        menuContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>`;
        return;
      }
      menuItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-xl shadow-md p-4 flex flex-col items-center hover:shadow-lg transition";
        card.innerHTML = `
          <img src="${item.img}" alt="${item.name}" class="w-24 h-24 mb-3 object-cover rounded">
          <h2 class="font-semibold">${item.name}</h2>
          <p class="text-gray-600 mb-3">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addToOrder(${item.id})">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        `;
        menuContainer.appendChild(card);
      });
    }
    renderMenu();

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
    function addToOrder(id) {
      const item = menuItems.find(i => i.id === id);
      const existing = order.find(o => o.id === id);
      if (existing) existing.qty++; else order.push({...item, qty:1});
      updateOrderSummary();
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
    function updateOrderSummary() {
      orderList.innerHTML = "";
      let total = 0;
      order.forEach(item => {
        total += item.price * item.qty;
        orderList.innerHTML += `<li class="flex justify-between items-center mb-1">${item.name} x${item.qty} <button onclick="removeItem(${item.id})" class="text-red-500 ml-2">‚úï</button></li>`;
      });
      totalDisplay.textContent = total;
      orderSummary.classList.toggle("hidden", order.length===0);
    }

    function removeItem(id) { order = order.filter(i=>i.id!==id); updateOrderSummary(); }

    // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡πÅ‡∏ó‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
    function submitOrder() {
      if(order.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£");

      const orderData = {
        timestamp: new Date().toLocaleString(),
        items: order,
        total: totalDisplay.textContent
      };

      allOrders.push(orderData);
      localStorage.setItem("allOrders", JSON.stringify(allOrders));

      alert("‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");

      order = [];
      updateOrderSummary();

      showSection('report');
      updateReport();
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ó‡πá‡∏ö
    function showSection(section){
      document.getElementById("menuSection").classList.add("hidden");
      document.getElementById("reportSection").classList.add("hidden");
      if(section==="menu") document.getElementById("menuSection").classList.remove("hidden");
      else if(section==="report") document.getElementById("reportSection").classList.remove("hidden");
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
    function updateReport() {
      const reportSection = document.getElementById("reportSection");
      reportSection.innerHTML = `<h2 class="text-2xl font-semibold mb-4">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
        <button onclick="endOfDay()" class="mb-4 bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700">‡∏à‡∏ö‡∏ß‡∏±‡∏ô</button>`; // ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏ö‡∏ß‡∏±‡∏ô

      if(allOrders.length === 0){
        reportSection.innerHTML += `<div class="bg-white p-4 rounded shadow">
          <p class="text-gray-700">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        </div>`;
        return;
      }

      let totalIncome = 0;
      const menuSummary = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏¢‡∏≠‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π
      const container = document.createElement("div");
      container.className = "bg-white p-4 rounded shadow space-y-4";

      allOrders.forEach((ord, index) => {
        let orderHtml = `<div class="border-b pb-2">
          <p class="font-semibold">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index+1} - ${ord.timestamp}</p>
          <ul class="ml-4 text-gray-700">`;
        ord.items.forEach(item => {
          const itemTotal = item.price * item.qty;
          orderHtml += `<li>${item.name} x${item.qty} = ${itemTotal} ‡∏ö‡∏≤‡∏ó</li>`;

          // ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏°‡∏ô‡∏π
          if(menuSummary[item.name]) menuSummary[item.name].qty += item.qty;
          else menuSummary[item.name] = {price: item.price, qty: item.qty};

          totalIncome += itemTotal;
        });
        orderHtml += `</ul>
          <p class="font-semibold">‡∏£‡∏ß‡∏°: ${ord.total} ‡∏ö‡∏≤‡∏ó</p>
        </div>`;
        container.innerHTML += orderHtml;
      });

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π
      let summaryHtml = `<div class="bg-gray-100 p-3 rounded shadow mt-4">
        <p class="font-semibold mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏ô‡∏π</p>
        <ul>`;
      for(const name in menuSummary){
        const item = menuSummary[name];
        summaryHtml += `<li>${name}: ${item.qty} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏£‡∏ß‡∏° ${item.price*item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
      }
      summaryHtml += `</ul></div>`;
      container.innerHTML += summaryHtml;

      reportSection.appendChild(container);

      reportSection.innerHTML += `<p class="mt-4 font-bold text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalIncome} ‡∏ö‡∏≤‡∏ó</p>`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏ö‡∏ß‡∏±‡∏ô + ‡∏™‡∏£‡πâ‡∏≤‡∏á CSV
    function endOfDay() {
      if(allOrders.length === 0) {
        alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚ùå");
        return;
      }

      if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡∏ß‡∏±‡∏ô? ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")) {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á CSV
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "‡∏•‡∏≥‡∏î‡∏±‡∏ö,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤,‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢,‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°\n";

        let totalIncome = 0;
        const menuSummary = {};

        allOrders.forEach((ord, index) => {
          ord.items.forEach(item => {
            const itemTotal = item.price * item.qty;
            csvContent += `${index+1},${ord.timestamp},${item.name},${item.qty},${item.price},${itemTotal}\n`;
            totalIncome += itemTotal;

            // ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏°‡∏ô‡∏π
            if(menuSummary[item.name]) menuSummary[item.name].qty += item.qty;
            else menuSummary[item.name] = {price: item.price, qty: item.qty};
          });
        });

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π
        csvContent += `\n‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏ô‡∏π\n‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢,‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°\n`;
        for(const name in menuSummary){
          const item = menuSummary[name];
          csvContent += `${name},${item.qty},${item.price},${item.price*item.qty}\n`;
        }

        csvContent += `\n,,‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î,,${totalIncome}\n`;

        // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        const today = new Date();
        const dateStr = today.toISOString().split("T")[0]; // YYYY-MM-DD
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î_${dateStr}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
        allOrders = [];
        localStorage.removeItem("allOrders");
        updateReport();

        alert("‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      }
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    function logout(){ window.location.href="index.html"; }

    // ‡∏û‡∏±‡∏ö/‡∏Ç‡∏¢‡∏≤‡∏¢ Sidebar
    function toggleSidebar(){
      const sidebar=document.getElementById("sidebar");
      sidebar.classList.toggle("sidebar-collapsed");
      sidebar.classList.toggle("w-16");
      sidebar.classList.toggle("w-64");

      // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Order Summary
      if(sidebar.classList.contains("w-16")){
        orderSummary.style.left="4rem";
        orderSummary.style.width="calc(100% - 4rem)";
      }else{
        orderSummary.style.left="16rem";
        orderSummary.style.width="calc(100% - 16rem)";
      }
    }

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    updateReport();
  </script>

</body>
</html>
