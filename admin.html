<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .sidebar-text {
      transition: opacity 0.3s, transform 0.3s;
      white-space: nowrap;
    }
    .sidebar-collapsed .sidebar-text {
      opacity: 0;
      transform: translateX(-20px);
      display: none;
    }
  </style>
</head>
<body class="bg-red-900 flex">

  <!-- Sidebar -->
  <aside id="sidebar" class="bg-yellow-500 h-screen p-5 flex flex-col transition-all duration-300 w-64">
    <button onclick="toggleSidebar()" class="mb-6 bg-yellow-300 p-2 rounded hover:bg-yellow-400">‚â°</button>
    <h1 class="text-xl font-bold mb-6 text-center sidebar-text">Admin</h1>
    <nav class="flex flex-col space-y-3">
      <button onclick="showSection('menu')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('order')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('report')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
      </button>
      <button onclick="logout()" class="flex items-center gap-2 bg-red-500 text-white py-2 px-2 rounded hover:bg-red-600 mt-auto">
        <span class="sidebar-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
      </button>
    </nav>
  </aside>

  <!-- Main content -->
  <main id="mainContent" class="flex-1 p-6 transition-all duration-300">

    <!-- Section ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Admin) -->
    <section id="menuSection">
      <h2 class="text-2xl font-semibold mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Admin)</h2>
      <div class="overflow-x-auto bg-white rounded-xl shadow-md mb-6">
        <table class="min-w-full border-collapse">
          <thead class="bg-indigo-100">
            <tr>
              <th class="p-3 border">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
              <th class="p-3 border">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
              <th class="p-3 border">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
              <th class="p-3 border">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="menuTable"></tbody>
        </table>
      </div>
      <div class="bg-white shadow-md rounded-xl p-4">
        <h3 class="text-lg font-semibold mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà</h3>
        <form id="addMenuForm" class="grid md:grid-cols-3 gap-3">
          <input type="text" id="menuName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π" class="border p-2 rounded" required>
          <input type="number" id="menuPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="border p-2 rounded" required>
          <input type="text" id="menuImage" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)" class="border p-2 rounded" required>
          <button class="col-span-3 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
        </form>
      </div>
    </section>

    <!-- Section ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
    <section id="orderSection" class="hidden">
      <h2 class="text-2xl font-semibold mb-4">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>

      <section id="promoSection" class="mb-6">
        <h3 class="text-xl font-semibold mb-2">üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h3>
        <div id="promoContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-4"></div>
      </section>

      <div id="orderMenuContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-6"></div>

      <div id="orderSummary" class="fixed bottom-0 left-64 w-[calc(100%-16rem)] bg-white shadow-md border-t border-gray-200 p-4 hidden">
        <h2 class="text-lg font-semibold mb-2">üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <ul id="orderList" class="text-gray-700 mb-2"></ul>
        <p class="font-semibold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</p>
        <button onclick="submitOrder()" class="mt-2 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
      </div>
    </section>

    <!-- Section ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ -->
    <section id="reportSection" class="hidden"></section>

  </main>

  <script>
    // ---------- ‡πÄ‡∏°‡∏ô‡∏π ----------
    let menuItems = JSON.parse(localStorage.getItem("menuData")) || [
      { id: 1, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÄ‡∏•‡πá‡∏Å", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
      { id: 2, name: "‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
      { id: 3, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÉ‡∏´‡∏ç‡πà", price: 29, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" }
    ];
    let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
    const menuTable = document.getElementById("menuTable");
    const addMenuForm = document.getElementById("addMenuForm");
    const orderMenuContainer = document.getElementById("orderMenuContainer");
    const orderSummary = document.getElementById("orderSummary");
    const orderList = document.getElementById("orderList");
    const totalDisplay = document.getElementById("total");
    let order = [];

    function renderTable() {
      menuTable.innerHTML = "";
      menuItems.forEach((item, index) => {
        menuTable.innerHTML += `
          <tr class="text-center">
            <td class="border p-2"><img src="${item.img}" class="w-16 h-16 mx-auto"></td>
            <td class="border p-2">${item.name}</td>
            <td class="border p-2">${item.price}</td>
            <td class="border p-2">
              <button onclick="editMenu(${index})" class="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deleteMenu(${index})" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600">‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      });
    }
    renderTable();

    addMenuForm.addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("menuName").value.trim();
      const price = parseFloat(document.getElementById("menuPrice").value);
      const img = document.getElementById("menuImage").value.trim();
      if (!name || !price || !img) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
      menuItems.push({ id: Date.now(), name, price, img });
      localStorage.setItem("menuData", JSON.stringify(menuItems));
      renderTable(); renderOrderMenu(); addMenuForm.reset();
    });

    function editMenu(index) {
      const item = menuItems[index];
      const newName = prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà:", item.name);
      const newPrice = prompt("‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà:", item.price);
      if (newName && newPrice) {
        item.name = newName;
        item.price = parseFloat(newPrice);
        localStorage.setItem("menuData", JSON.stringify(menuItems));
        renderTable(); renderOrderMenu();
      }
    }

    function deleteMenu(index) {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) {
        menuItems.splice(index, 1);
        localStorage.setItem("menuData", JSON.stringify(menuItems));
        renderTable(); renderOrderMenu();
      }
    }

    // ---------- ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ----------
    function renderOrderMenu() {
      orderMenuContainer.innerHTML = "";
      if (menuItems.length === 0) {
        orderMenuContainer.innerHTML = `<p class="text-center text-gray-500 col-span-full">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>`;
        return;
      }
      menuItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-xl shadow-md p-4 flex flex-col items-center hover:shadow-lg transition";
        card.innerHTML = `
          <img src="${item.img}" alt="${item.name}" class="w-24 h-24 mb-3 object-cover rounded">
          <h2 class="font-semibold">${item.name}</h2>
          <p class="text-gray-600 mb-3">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addToOrder(${item.id})">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        `;
        orderMenuContainer.appendChild(card);
      });
    }

    function addToOrder(id) {
      const item = menuItems.find(i => i.id === id);
      const existing = order.find(o => o.id === id);
      if (existing) existing.qty++;
      else order.push({ ...item, qty: 1 });
      updateOrderSummary();
    }

    function updateOrderSummary() {
      orderList.innerHTML = "";
      let total = 0;
      order.forEach(item => {
        total += item.price * item.qty;
        orderList.innerHTML += `<li class="flex justify-between mb-1">${item.name} x${item.qty} <button onclick="removeItem(${item.id})" class="text-red-500 ml-2">‚úï</button></li>`;
      });
      totalDisplay.textContent = total;
      orderSummary.classList.toggle("hidden", order.length === 0);
    }

    function removeItem(id) {
      order = order.filter(i => i.id !== id);
      updateOrderSummary();
    }

    function submitOrder() {
      if (order.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£");
      const orderData = { timestamp: new Date().toLocaleString(), items: order, total: totalDisplay.textContent };
      allOrders.push(orderData);
      localStorage.setItem("allOrders", JSON.stringify(allOrders));
      alert("‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      order = [];
      updateOrderSummary();
      showSection('report');
      updateReport();
    }

    // ---------- ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ----------
    function updateReport() {
      const reportSection = document.getElementById("reportSection");
      reportSection.innerHTML = `<h2 class="text-2xl font-semibold mb-4">üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>`;
      if (allOrders.length === 0) {
        reportSection.innerHTML += `<div class="bg-white p-4 rounded shadow">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>`;
        return;
      }

      let totalIncome = 0;
      const container = document.createElement("div");
      container.className = "bg-white p-4 rounded shadow space-y-4";
      allOrders.forEach((ord, index) => {
        let orderHtml = `<div class="border-b pb-2"><p class="font-semibold">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index + 1} - ${ord.timestamp}</p><ul class="ml-4">`;
        ord.items.forEach(item => {
          orderHtml += `<li>${item.name} x${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
          totalIncome += item.price * item.qty;
        });
        orderHtml += `</ul></div>`;
        container.innerHTML += orderHtml;
      });

      reportSection.appendChild(container);
      reportSection.innerHTML += `<p class="mt-4 font-bold text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalIncome} ‡∏ö‡∏≤‡∏ó</p>`;

      // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á Google Sheet
      const sendBtn = document.createElement("button");
      sendBtn.textContent = "‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet";
      sendBtn.className = "mt-4 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700";
      sendBtn.onclick = sendToGoogleSheet;
      reportSection.appendChild(sendBtn);

      // ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏ö‡∏ß‡∏±‡∏ô
      const endDayBtn = document.createElement("button");
      endDayBtn.textContent = "‡∏à‡∏ö‡∏ß‡∏±‡∏ô (‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)";
      endDayBtn.className = "mt-4 ml-2 bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700";
      endDayBtn.onclick = endDay;
      reportSection.appendChild(endDayBtn);
    }

    // ---------- ‡∏à‡∏ö‡∏ß‡∏±‡∏ô ----------
    function endDay() {
      if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡∏ß‡∏±‡∏ô? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á!")) {
        localStorage.removeItem("allOrders");
        allOrders = [];
        alert("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
        updateReport();
      }
    }

    // ---------- ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÅ‡∏•‡πâ‡∏ß) ----------
    async function sendToGoogleSheet() {
      if (allOrders.length === 0) {
        alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏™‡πà‡∏á");
        return;
      }

      const dataToSend = [];
      allOrders.forEach(order => {
        order.items.forEach(item => {
          dataToSend.push({
            date: order.timestamp,
            name: item.name,
            qty: item.qty,
            total: item.price * item.qty
          });
        });
      });

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbz4cObUvyCWvlIBO9Iee9dJ5vi6svCTWFSK9rj8k-_ADFGj-QpheDHKWoC2HLATQgP3Zw/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dataToSend)
        });

        if (response.ok) {
          alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!");
        } else {
          alert("‚ùå ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (response not ok)");
        }
      } catch (error) {
        alert("‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        console.error(error);
      }
    }

    // ---------- Sidebar ----------
    function logout() { window.location.href = "index.html"; }
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("sidebar-collapsed");
      sidebar.classList.toggle("w-16");
      sidebar.classList.toggle("w-64");
      if (sidebar.classList.contains("w-16")) {
        orderSummary.style.left = "4rem"; orderSummary.style.width = "calc(100% - 4rem)";
      } else {
        orderSummary.style.left = "16rem"; orderSummary.style.width = "calc(100% - 16rem)";
      }
    }
    function showSection(section) {
      document.getElementById("menuSection").classList.add("hidden");
      document.getElementById("orderSection").classList.add("hidden");
      document.getElementById("reportSection").classList.add("hidden");
      if (section === "menu") document.getElementById("menuSection").classList.remove("hidden");
      if (section === "order") document.getElementById("orderSection").classList.remove("hidden");
      if (section === "report") document.getElementById("reportSection").classList.remove("hidden");
    }

    renderOrderMenu();
    updateReport();
  </script>
</body>
</html>