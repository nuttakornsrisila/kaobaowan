<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Online/Offline</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Online/Offline</h1>
    
    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 mb-6">
      <h2 class="font-bold text-lg mb-2">‚ö†Ô∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</h2>
      <ol class="list-decimal list-inside space-y-2">
        <li>‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô <strong>‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà 1</strong> (‡πÄ‡∏ä‡πà‡∏ô Chrome)</li>
        <li>‡∏Å‡∏î Login ‡∏î‡πâ‡∏ß‡∏¢ staff1</li>
        <li>‡πÄ‡∏õ‡∏¥‡∏î <code>admin.html</code> ‡πÉ‡∏ô <strong>‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</strong> (Chrome)</li>
        <li>‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Üí ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô <strong>üü¢ Online</strong></li>
        <li>‡πÄ‡∏õ‡∏¥‡∏î <code>admin.html</code> ‡πÉ‡∏ô <strong>‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô</strong> (‡πÄ‡∏ä‡πà‡∏ô Firefox)</li>
        <li>‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚Üí ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô <strong>üü¢ Online</strong> (‡∏ñ‡πâ‡∏≤ login ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ)</li>
      </ol>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-6">
      <!-- Login Panel -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">1. ‡∏à‡∏≥‡∏•‡∏≠‡∏á Login</h2>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
            <select id="userSelect" class="w-full p-2 border rounded">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ --</option>
              <option value="admin">admin (Admin)</option>
              <option value="staff1">staff1 (Staff)</option>
              <option value="staff2">staff2 (Staff)</option>
            </select>
          </div>
          <button onclick="simulateLogin()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
            Login
          </button>
          <button onclick="simulateLogout()" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">
            Logout
          </button>
        </div>
        <div id="currentUserDisplay" class="mt-4 p-3 bg-gray-100 rounded"></div>
      </div>

      <!-- Status Panel -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-bold mb-4">2. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
        <button onclick="checkAllStatus()" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 mb-4">
          üîÑ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        </button>
        <div id="statusDisplay" class="space-y-2"></div>
      </div>
    </div>

    <!-- Online Users List -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">3. ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ Online</h2>
      <button onclick="viewOnlineUsers()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mb-4">
        ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
      </button>
      <div id="onlineUsersDisplay"></div>
    </div>

    <!-- Last Login Times -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold mb-4">4. ‡πÄ‡∏ß‡∏•‡∏≤ Login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
      <button onclick="viewLastLoginTimes()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 mb-4">
        ‡∏î‡∏π‡πÄ‡∏ß‡∏•‡∏≤ Login
      </button>
      <div id="lastLoginDisplay"></div>
    </div>

    <!-- Log Panel -->
    <div class="mt-6 bg-gray-800 text-white p-6 rounded-lg">
      <h2 class="text-xl font-bold mb-4">üìã Log</h2>
      <div id="logPanel" class="space-y-1 text-sm font-mono max-h-64 overflow-y-auto"></div>
    </div>
  </div>

  <script>
    function log(message, type = 'info') {
      const logPanel = document.getElementById('logPanel');
      const time = new Date().toLocaleTimeString();
      const colors = {
        info: 'text-blue-400',
        success: 'text-green-400',
        warning: 'text-yellow-400',
        error: 'text-red-400'
      };
      const entry = document.createElement('div');
      entry.className = colors[type] || colors.info;
      entry.textContent = `[${time}] ${message}`;
      logPanel.appendChild(entry);
      logPanel.scrollTop = logPanel.scrollHeight;
    }

    function simulateLogin() {
      const username = document.getElementById('userSelect').value;
      if (!username) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
        return;
      }

      const users = {
        'admin': { username: 'admin', role: 'admin' },
        'staff1': { username: 'staff1', role: 'staff' },
        'staff2': { username: 'staff2', role: 'staff' }
      };

      const user = users[username];
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á sessionStorage
      sessionStorage.setItem('restaurant_current_user', JSON.stringify(user));
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      localStorage.setItem(`last_login_${username}`, Date.now().toString());
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ online_users list
      const onlineUsers = JSON.parse(localStorage.getItem('online_users') || '[]');
      const filteredUsers = onlineUsers.filter(u => u.username !== username);
      filteredUsers.push({
        username: username,
        role: user.role,
        lastActive: Date.now()
      });
      localStorage.setItem('online_users', JSON.stringify(filteredUsers));
      
      document.getElementById('currentUserDisplay').innerHTML = `
        <p class="font-semibold text-green-600">‚úÖ Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
        <p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${user.username} (${user.role})</p>
        <p class="text-sm text-gray-500 mt-2">‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleString('th-TH')}</p>
      `;
      
      log(`Login: ${user.username}`, 'success');
      checkAllStatus();
    }

    function simulateLogout() {
      const currentUser = sessionStorage.getItem('restaurant_current_user');
      if (currentUser) {
        const user = JSON.parse(currentUser);
        
        // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å online_users
        const onlineUsers = JSON.parse(localStorage.getItem('online_users') || '[]');
        const filteredUsers = onlineUsers.filter(u => u.username !== user.username);
        localStorage.setItem('online_users', JSON.stringify(filteredUsers));
        
        log(`Logout: ${user.username}`, 'info');
      }
      
      sessionStorage.removeItem('restaurant_current_user');
      document.getElementById('currentUserDisplay').innerHTML = '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login</p>';
      checkAllStatus();
    }

    function isUserOnline(username) {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å sessionStorage
      const currentUser = sessionStorage.getItem('restaurant_current_user');
      if (currentUser) {
        const user = JSON.parse(currentUser);
        if (user.username === username) return true;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å localStorage
      const onlineUsers = JSON.parse(localStorage.getItem('online_users') || '[]');
      const userOnline = onlineUsers.find(u => 
        u.username === username && 
        (Date.now() - u.lastActive) < 60000
      );
      
      if (userOnline) return true;
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      const lastLoginTime = localStorage.getItem(`last_login_${username}`);
      if (lastLoginTime) {
        const timeDiff = Date.now() - parseInt(lastLoginTime);
        return timeDiff < 300000; // 5 ‡∏ô‡∏≤‡∏ó‡∏µ
      }
      
      return false;
    }

    function checkAllStatus() {
      const users = ['admin', 'staff1', 'staff2'];
      const display = document.getElementById('statusDisplay');
      
      let html = '<div class="space-y-2">';
      users.forEach(username => {
        const isOnline = isUserOnline(username);
        html += `
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
            <span class="font-medium">${username}</span>
            <span class="px-3 py-1 ${isOnline ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-500'} rounded-full text-sm">
              ${isOnline ? 'üü¢ Online' : '‚ö™ Offline'}
            </span>
          </div>
        `;
      });
      html += '</div>';
      
      display.innerHTML = html;
      log('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'info');
    }

    function viewOnlineUsers() {
      const onlineUsers = JSON.parse(localStorage.getItem('online_users') || '[]');
      const display = document.getElementById('onlineUsersDisplay');
      
      if (onlineUsers.length === 0) {
        display.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ online</p>';
        log('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ online', 'warning');
        return;
      }
      
      let html = '<div class="space-y-2">';
      onlineUsers.forEach(user => {
        const timeDiff = Date.now() - user.lastActive;
        const minutes = Math.floor(timeDiff / 60000);
        const seconds = Math.floor((timeDiff % 60000) / 1000);
        
        html += `
          <div class="p-3 bg-green-50 border border-green-200 rounded">
            <p class="font-medium">${user.username} (${user.role})</p>
            <p class="text-sm text-gray-600">Active: ${minutes}m ${seconds}s ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</p>
          </div>
        `;
      });
      html += '</div>';
      
      display.innerHTML = html;
      log(`‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ online: ${onlineUsers.length} ‡∏Ñ‡∏ô`, 'success');
    }

    function viewLastLoginTimes() {
      const users = ['admin', 'staff1', 'staff2'];
      const display = document.getElementById('lastLoginDisplay');
      
      let html = '<div class="space-y-2">';
      users.forEach(username => {
        const lastLoginTime = localStorage.getItem(`last_login_${username}`);
        let timeText = '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢ login';
        
        if (lastLoginTime) {
          const date = new Date(parseInt(lastLoginTime));
          timeText = date.toLocaleString('th-TH');
          
          const timeDiff = Date.now() - parseInt(lastLoginTime);
          const minutes = Math.floor(timeDiff / 60000);
          timeText += ` (${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß)`;
        }
        
        html += `
          <div class="p-3 bg-gray-50 rounded">
            <p class="font-medium">${username}</p>
            <p class="text-sm text-gray-600">${timeText}</p>
          </div>
        `;
      });
      html += '</div>';
      
      display.innerHTML = html;
      log('‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î', 'info');
    }

    // Initialize
    log('‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'success');
    document.getElementById('currentUserDisplay').innerHTML = '<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login</p>';
    checkAllStatus();
  </script>
</body>
</html>
