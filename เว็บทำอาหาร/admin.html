<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="auth.js"></script>
  <script>
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ auth.js ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    window.addEventListener('load', function() {
      if (typeof getUsers === 'function') {
        console.log('auth.js loaded successfully');
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
        const users = getUsers();
        console.log('Initial users:', users);
      } else {
        console.error('auth.js not loaded correctly!');
      }
    });
  </script>
  <style>
    .sidebar-text {
      transition: opacity 0.3s, transform 0.3s;
      white-space: nowrap;
    }
    .sidebar-collapsed .sidebar-text {
      opacity: 0;
      transform: translateX(-20px);
      display: none;
    }
  </style>
</head>
<body class="bg-red-900 flex">

  <!-- Sidebar -->
  <aside id="sidebar" class="bg-yellow-500 h-screen p-5 flex flex-col transition-all duration-300 w-64">
    <button onclick="toggleSidebar()" class="mb-6 bg-yellow-300 p-2 rounded hover:bg-yellow-400">‚â°</button>
    <h1 class="text-xl font-bold mb-6 text-center sidebar-text">Admin</h1>
    <nav class="flex flex-col space-y-3">
      <button onclick="showSection('menu')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('order')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('report')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
      </button>
      <button onclick="showSection('history')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>
      </button>
      <button onclick="showSection('users')" class="flex items-center gap-2 bg-yellow-300 py-2 px-2 rounded hover:bg-yellow-400">
        <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
      </button>
      <button onclick="logout()" class="flex items-center gap-2 bg-red-500 text-white py-2 px-2 rounded hover:bg-red-600 mt-auto">
        <span class="sidebar-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
      </button>

    </nav>
  </aside>

  <!-- Main content -->
  <main id="mainContent" class="flex-1 p-6 transition-all duration-300">

    <!-- Section ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Admin) -->
    <section id="menuSection">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Admin)</h2>
        <div class="flex gap-2">
          <button onclick="saveMenu(); alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° \'‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π\' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
            </svg>
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π
          </button>
          <span class="bg-gray-100 px-4 py-2 rounded-lg text-gray-700 flex items-center">
            üìã ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="menuCount" class="font-bold ml-2">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
          </span>
        </div>
      </div>
      <div class="overflow-x-auto bg-white rounded-xl shadow-md mb-6">
        <table class="min-w-full border-collapse">
          <thead class="bg-indigo-100">
            <tr>
              <th class="p-3 border">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
              <th class="p-3 border">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
              <th class="p-3 border">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
              <th class="p-3 border">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="menuTable"></tbody>
        </table>
      </div>
      <div class="bg-white shadow-md rounded-xl p-4">
        <h3 class="text-lg font-semibold mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà</h3>
        <form id="addMenuForm" class="grid md:grid-cols-3 gap-3">
          <input type="text" id="menuName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π" class="border p-2 rounded" required>
          <input type="number" id="menuPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="border p-2 rounded" required>

          <div class="flex flex-col gap-2 md:col-span-3">
            <div class="flex items-center gap-4">
              <label class="inline-flex items-center"><input type="radio" name="imageSource" id="imageSrcUrl" value="url" checked> <span class="ml-2">‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå</span></label>
              <label class="inline-flex items-center"><input type="radio" name="imageSource" id="imageSrcFile" value="file"> <span class="ml-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span></label>
            </div>

            <input type="text" id="menuImageUrl" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)" class="border p-2 rounded">
            <input type="file" id="menuImageFile" accept="image/*" class="border p-2 rounded hidden">
            <div class="text-sm text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>
          </div>

          <div class="md:col-span-3 flex items-center gap-4">
            <img id="previewImage" src="" alt="Preview" class="w-24 h-24 object-cover rounded hidden cursor-pointer" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢">
            <div>
              <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
              <button type="button" onclick="pushMenuToSheet()" class="ml-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Sync to Google Sheet</button>
              <button type="button" onclick="loadMenuFromSheet()" class="ml-2 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Load from Sheet</button>
            </div>
          </div>

        </form>
      </div>
    </section>

    <!-- Section ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ + ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
    <section id="orderSection" class="hidden">
      <h2 class="text-2xl font-semibold mb-4">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>

      <!-- ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
      <section id="promoSection" class="mb-6">
        <h3 class="text-xl font-semibold mb-2">üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h3>
        <div id="promoContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-4"></div>
      </section>

      <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏Å‡∏ï‡∏¥ -->
      <div id="orderMenuContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-6"></div>

      <!-- Order Summary -->
      <div id="orderSummary" class="fixed bottom-0 left-64 w-[calc(100%-16rem)] bg-white shadow-md border-t border-gray-200 p-4 hidden">
        <h2 class="text-lg font-semibold mb-2">üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <ul id="orderList" class="text-gray-700 mb-2"></ul>
        <p class="font-semibold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</p>
        <button onclick="submitOrder()" class="mt-2 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
      </div>
    </section>

    <!-- Section ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ -->
    <section id="reportSection" class="hidden"></section>

    <!-- Section ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
    <section id="usersSection" class="hidden">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold mb-6">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
        
        <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <p class="text-3xl font-bold" id="totalUsers">0</p>
              </div>
              <svg class="w-12 h-12 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
            </div>
          </div>
          <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                <p class="text-3xl font-bold" id="adminCount">0</p>
              </div>
              <svg class="w-12 h-12 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
            </div>
          </div>
          <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
                <p class="text-3xl font-bold" id="staffCount">0</p>
              </div>
              <svg class="w-12 h-12 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà -->
        <div class="mb-8 bg-gradient-to-r from-gray-50 to-gray-100 p-6 rounded-lg border-2 border-dashed border-gray-300">
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
          </h3>
          <form id="addUserForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                <input type="text" id="newUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full p-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none" required>
              </div>
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input type="password" id="newPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none" required>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
              <div class="grid grid-cols-2 gap-4">
                <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition">
                  <input type="radio" name="newRole" id="newRoleStaff" value="staff" required class="mr-3 w-4 h-4">
                  <div>
                    <span class="font-medium">üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span>
                    <p class="text-xs text-gray-500">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                  </div>
                </label>
                <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition">
                  <input type="radio" name="newRole" id="newRoleAdmin" value="admin" required class="mr-3 w-4 h-4">
                  <div>
                    <span class="font-medium">üëë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</span>
                    <p class="text-xs text-gray-500">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå</p>
                  </div>
                </label>
              </div>
            </div>
            <button type="submit" class="bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-lg hover:from-green-600 hover:to-green-700 w-full font-medium shadow-lg hover:shadow-xl transition flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            </button>
          </form>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div>
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </h3>
          <div class="grid grid-cols-1 gap-4" id="usersList">
            <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
          </div>
        </div>
      </div>
    </section>

    <!-- Section ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß -->
    <section id="historySection" class="hidden">
      <h2 class="text-2xl font-semibold mb-4">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</h2>
      <div id="historyContainer" class="bg-white p-4 rounded shadow space-y-4"></div>
    </section>


  </main>

  <script>
    // ---------- ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏Å‡∏ï‡∏¥ ----------
    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    let menuItems = [];
    
    function loadMenuData() {
      const savedMenu = localStorage.getItem("menuData");
      if (savedMenu) {
        menuItems = JSON.parse(savedMenu);
        console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å localStorage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + menuItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)');
      } else {
        // ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        menuItems = [
          { id: 1, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÄ‡∏•‡πá‡∏Å", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
          { id: 2, name: "‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
          { id: 3, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÉ‡∏´‡∏ç‡πà", price: 29, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" },
          { id: 4, name: "‡πÑ‡∏Å‡πà‡πÑ‡∏£‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å", price: 12, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" },
          { id: 5, name: "‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÑ‡∏Å‡πà", price: 39, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          { id: 6, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î‡πÄ‡∏Å‡πä‡∏≤", price: 49, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          { id: 7, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î‡πÄ‡∏Å‡πä‡∏≤ + ‡∏ã‡∏≠‡∏™‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ", price: 59, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå & ‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å ---
          {id:201, name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå S", price:29, img:"https://cdn-icons-png.flaticon.com/512/1046/1046784.png", size:"S"},
          {id:202, name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå M", price:39, img:"https://cdn-icons-png.flaticon.com/512/1046/1046784.png", size:"M"},
          {id:203, name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå L", price:49, img:"https://cdn-icons-png.flaticon.com/512/1046/1046784.png", size:"L"},
          {id:204, name:"‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å S", price:20, img:"https://cdn-icons-png.flaticon.com/512/1046/1046785.png", size:"S"},
          {id:205, name:"‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å M", price:30, img:"https://cdn-icons-png.flaticon.com/512/1046/1046785.png", size:"M"},
          {id:206, name:"‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å L", price:40, img:"https://cdn-icons-png.flaticon.com/512/1046/1046785.png", size:"L"}
        ];
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏•‡∏á localStorage
        saveMenu();
        console.log('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage');
      }
    }
    
    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    loadMenuData();

    let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
    let pendingOrders = JSON.parse(localStorage.getItem("pendingOrders")) || [];
    let completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
    const menuTable = document.getElementById("menuTable");
    const addMenuForm = document.getElementById("addMenuForm");
    const orderMenuContainer = document.getElementById("orderMenuContainer");
    const orderSummary = document.getElementById("orderSummary");
    const orderList = document.getElementById("orderList");
    const totalDisplay = document.getElementById("total");
    let order = [];

    // ---------- Admin: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π ----------
    function renderTable(){
      menuTable.innerHTML="";
      menuItems.forEach((item,index)=>{
        menuTable.innerHTML+=`
          <tr class="text-center">
            <td class="border p-2"><img src="${item.img}" class="w-16 h-16 mx-auto object-cover rounded"></td>
            <td class="border p-2">${item.name}</td>
            <td class="border p-2">${item.price}</td>
            <td class="border p-2">
              <button onclick="editMenu(${index})" class="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deleteMenu(${index})" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600">‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      });
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ô‡∏π
      const menuCountEl = document.getElementById('menuCount');
      if (menuCountEl) menuCountEl.textContent = menuItems.length;
    }
    renderTable();

    addMenuForm.addEventListener("submit", e=>{
      e.preventDefault();
      const name=document.getElementById("menuName").value.trim();
      const price=parseFloat(document.getElementById("menuPrice").value);
      // determine image source
      const useFile = document.getElementById('imageSrcFile').checked;
      let img = '';
      if (useFile) {
        img = window._lastMenuImageDataUrl || '';
      } else {
        img = document.getElementById('menuImageUrl').value.trim();
      }
      if(!name||!price) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤");
      menuItems.push({id:Date.now(),name,price,img});
      renderTable(); saveMenu(); renderOrderMenu(); renderPromos(); addMenuForm.reset();
      const preview = document.getElementById('previewImage'); preview.src=''; preview.classList.add('hidden');
      // reset file cache
      window._lastMenuImageDataUrl = null;
    });

    // preview image when URL entered
    document.getElementById('menuImageUrl').addEventListener('input', function(){
      const val = this.value.trim(); const preview = document.getElementById('previewImage');
      if(val){ preview.src = val; preview.classList.remove('hidden'); } else { preview.src=''; preview.classList.add('hidden'); }
    });

    // file input preview
    document.getElementById('menuImageFile').addEventListener('change', function(){
      const file = this.files && this.files[0];
      const preview = document.getElementById('previewImage');
      if(!file){ preview.src=''; preview.classList.add('hidden'); window._lastMenuImageDataUrl = null; return; }
      const reader = new FileReader();
      reader.onload = function(ev){
        const dataUrl = ev.target.result;
        window._lastMenuImageDataUrl = dataUrl;
        preview.src = dataUrl; preview.classList.remove('hidden');
      };
      reader.readAsDataURL(file);
    });

    // toggle between url/file inputs
    document.getElementById('imageSrcUrl').addEventListener('change', function(){
      if(this.checked){ document.getElementById('menuImageUrl').classList.remove('hidden'); document.getElementById('menuImageFile').classList.add('hidden'); }
    });
    document.getElementById('imageSrcFile').addEventListener('change', function(){
      if(this.checked){ document.getElementById('menuImageUrl').classList.add('hidden'); document.getElementById('menuImageFile').classList.remove('hidden'); }
    });

    // preview click to open full image in new window
    document.getElementById('previewImage').addEventListener('click', function(){ if(this.src) window.open(this.src, '_blank'); });

    function editMenu(index){
      const item=menuItems[index];
      const newName=prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà:",item.name);
      const newPrice=prompt("‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà:",item.price);
      if(newName&&newPrice){ item.name=newName; item.price=parseFloat(newPrice); renderTable(); saveMenu(); renderOrderMenu(); renderPromos(); }
    }

    function deleteMenu(index){
      if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")){
        menuItems.splice(index,1);
        renderTable(); saveMenu(); renderOrderMenu(); renderPromos();
      }
    }

    function saveMenu(){ 
      localStorage.setItem("menuData",JSON.stringify(menuItems)); 
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å timestamp ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
      const timestamp = Date.now();
      localStorage.setItem("menuDataTimestamp", timestamp.toString());
      console.log('‚úÖ ‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + menuItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)');
      
      // ‡∏™‡πà‡∏á Custom Event ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
      try {
        window.dispatchEvent(new CustomEvent('menuUpdated', { 
          detail: { count: menuItems.length, timestamp: timestamp } 
        }));
      } catch(e) {
        console.log('Custom event not supported');
      }
      
      // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
      showMenuUpdateNotification();
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π
    function showMenuUpdateNotification() {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';
      notification.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß (${menuItems.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.3s';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    // ---------- ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Staff-like) ----------
    function renderOrderMenu(){
      orderMenuContainer.innerHTML="";
      if(menuItems.length===0){
        orderMenuContainer.innerHTML=`<p class="text-center text-gray-500 col-span-full">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>`;
        return;
      }
      menuItems.forEach(item=>{
        const card=document.createElement("div");
        card.className="bg-white rounded-xl shadow-md p-4 flex flex-col items-center hover:shadow-lg transition";
        card.innerHTML=`
          <img src="${item.img}" alt="${item.name}" class="w-24 h-24 mb-3 object-cover rounded">
          <h2 class="font-semibold">${item.name}${item.size ? " ("+item.size+")" : ""}</h2>
          <p class="text-gray-600 mb-3">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addToOrder(${item.id})">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        `;
        orderMenuContainer.appendChild(card);
      });
    }

    function addToOrder(id){
      const item=menuItems.find(i=>i.id===id);
      const existing=order.find(o=>o.id===id);
      if(existing) existing.qty++; else order.push({...item,qty:1});
      updateOrderSummary();
    }

    function updateOrderSummary(){
      orderList.innerHTML="";
      let total=0;
      order.forEach(item=>{
        total+=item.price*item.qty;
        const sizeText=item.size ? ` (${item.size})` : "";
        orderList.innerHTML+=`<li class="flex justify-between items-center mb-1">${item.name}${sizeText} x${item.qty} <button onclick="removeItem(${item.id})" class="text-red-500 ml-2">‚úï</button></li>`;
      });
      totalDisplay.textContent=total;
      orderSummary.classList.toggle("hidden",order.length===0);
    }

    function removeItem(id){ order=order.filter(i=>i.id!==id); updateOrderSummary(); }

    function submitOrder(){
      if(order.length===0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£");
      const orderData = {
        id: Date.now(),
        timestamp: new Date().toLocaleString(),
        items: order,
        total: totalDisplay.textContent
      };
      pendingOrders.push(orderData);
      localStorage.setItem("pendingOrders", JSON.stringify(pendingOrders));
      alert("‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      order = [];
      updateOrderSummary();
      showSection('report');
      updateReport();
    }

    // ---------- ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô ----------
    const promoItems = [
      {id:101,name:"‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡∏ä‡∏¥‡πâ‡∏ô", options:[
        {label:"3 ‡∏ä‡∏¥‡πâ‡∏ô = 39 ‡∏ö‡∏≤‡∏ó", price:39, qty:1},
        {label:"6 ‡∏ä‡∏¥‡πâ‡∏ô = 79 ‡∏ö‡∏≤‡∏ó", price:79, qty:1},
        {label:"10 ‡∏ä‡∏¥‡πâ‡∏ô = 129 ‡∏ö‡∏≤‡∏ó", price:129, qty:1},
      ]},
      {id:102,name:"‡πÇ‡∏õ‡∏£‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÉ‡∏´‡∏ç‡πà", options:[
        {label:"3 ‡∏ä‡∏¥‡πâ‡∏ô = 79 ‡∏ö‡∏≤‡∏ó", price:79, qty:1},
        {label:"6 ‡∏ä‡∏¥‡πâ‡∏ô = 159 ‡∏ö‡∏≤‡∏ó", price:159, qty:1},
      ]},
      {id:103,name:"‡πÇ‡∏õ‡∏£‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÑ‡∏Å‡πà", options:[
        {label:"3 ‡∏ä‡∏¥‡πâ‡∏ô = 99 ‡∏ö‡∏≤‡∏ó", price:99, qty:1},
      ]},
      {id:104,name:"‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡πÑ‡∏£‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å", options:[
        {label:"5 ‡∏ä‡∏¥‡πâ‡∏ô = 59 ‡∏ö‡∏≤‡∏ó", price:59, qty:1},
        {label:"10 ‡∏ä‡∏¥‡πâ‡∏ô = 99 ‡∏ö‡∏≤‡∏ó", price:99, qty:1},
      ]},
      {id:105,name:"‡πÇ‡∏õ‡∏£‡∏£‡∏ß‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©", options:[
        {label:"‡∏™‡∏∞‡πÇ‡∏û‡∏Å 1 + ‡∏ô‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà 2 = 89 ‡∏ö‡∏≤‡∏ó", price:89, qty:1},
         {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå M + ‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î (‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 15) 3 ‡∏ä‡∏¥‡πâ‡∏ô = 69 ‡∏ö‡∏≤‡∏ó", price:69, qty:1},
      ]},
      {id:106,name:"‡πÄ‡∏ã‡∏ï‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°", options:[
        {label:"‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1  = 109 ‡∏ö‡∏≤‡∏ó", price:109, qty:1},
        {label:"‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 2  = 209 ‡∏ö‡∏≤‡∏ó", price:209, qty:1},
        {label:"‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 3  = 309 ‡∏ö‡∏≤‡∏ó", price:309, qty:1},
      ]},
      // --- ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå ---
      {id:201, name:"‡πÇ‡∏õ‡∏£‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå & ‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å", options:[
        {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå+‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å S = 29", price:29, qty:1, details:"S"},
        {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå+‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å M = 39", price:39, qty:1, details:"M"},
        {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå+‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å L = 49", price:49, qty:1, details:"L"},
      ]}
    ];
    const promoContainer=document.getElementById("promoContainer");

    function renderPromos(){
      promoContainer.innerHTML="";
      promoItems.forEach(promo=>{
        const card=document.createElement("div");
        card.className="bg-yellow-200 p-4 rounded-lg shadow flex flex-col gap-2";
        card.innerHTML=`<h3 class="font-semibold text-lg">${promo.name}</h3>`;
        promo.options.forEach(opt=>{
          const btn=document.createElement("button");
          btn.className="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600";
          btn.textContent=opt.label;
          btn.onclick=()=> addPromoToOrder(promo.name,opt.price,opt.qty,opt.details);
          card.appendChild(btn);
        });
        promoContainer.appendChild(card);
      });
    }

    function addPromoToOrder(name,price,qty,size){
      const existing=order.find(o=>o.name===name && o.price===price && o.size===size);
      if(existing) existing.qty+=qty;
      else order.push({id:Date.now(),name,price,qty,size});
      updateOrderSummary();
    }

    renderOrderMenu(); renderPromos();

    // ---------- ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ----------
    function updateReport(){
      const reportSection=document.getElementById("reportSection");
      reportSection.innerHTML=`<h2 class="text-2xl font-semibold mb-4">üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
        <div class="mb-3"><button onclick="loadPendingFromSheet()" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å Google Sheet</button></div>`;
      if(pendingOrders.length===0){ reportSection.innerHTML+=`<div class="bg-white p-4 rounded shadow">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>`; return; }
      let totalIncome=0;
      const container=document.createElement("div");
      container.className="bg-white p-4 rounded shadow space-y-4";
      const menuSummary={};
      pendingOrders.forEach((ord,index)=>{
        let orderHtml=`<div class="border-b pb-2"><p class="font-semibold">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index+1} - ${ord.timestamp}</p><ul class="ml-4">`;
        ord.items.forEach(item=>{
          const sizeText=item.size?` (${item.size})`:"";
          orderHtml+=`<li>${item.name}${sizeText} x${item.qty} = ${item.price*item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
          totalIncome+=item.price*item.qty;
          const key=item.name+(item.size?` (${item.size})`:"");
          if(menuSummary[key]) menuSummary[key].qty+=item.qty;
          else menuSummary[key]={price:item.price,qty:item.qty};
        });
        orderHtml+=`</ul>
        <p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${ord.total} ‡∏ö‡∏≤‡∏ó</p>
        <button onclick="confirmOrder(${index})" class="mt-2 bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</button>
        </div>`;
        container.innerHTML+=orderHtml;
      });
      let summaryHtml=`<div class="bg-gray-100 p-3 rounded shadow mt-4"><p class="font-semibold mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏ô‡∏π</p><ul>`;
      for(const name in menuSummary){
        const item=menuSummary[name];
        summaryHtml+=`<li>${name}: ${item.qty} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏£‡∏ß‡∏° ${item.price*item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
      }
      summaryHtml+=`</ul></div>`;
      container.innerHTML+=summaryHtml;
      reportSection.appendChild(container);
      reportSection.innerHTML+=`<p class="mt-4 font-bold text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalIncome} ‡∏ö‡∏≤‡∏ó</p>`;
    }
    // ---------- Pending on Sheet (shared) ----------
    let fetchedPending = [];
    async function loadPendingFromSheet(){
      if(!WEB_APP_URL || WEB_APP_URL.includes('REPLACE_WITH_YOUR_WEB_APP_URL')) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà WEB_APP_URL ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå admin.html');
      try{
        const res = await fetch(WEB_APP_URL + '?action=getPending');
        if(!res.ok) throw new Error('HTTP '+res.status);
        const j = await res.json();
        if(j && j.status === 'success'){
          fetchedPending = j.pending || [];
          renderFetchedPending();
          alert('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ pending ‡∏à‡∏≤‡∏Å Google Sheet ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        } else {
          console.warn('loadPendingFromSheet', j);
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î pending ‡πÑ‡∏î‡πâ');
        }
      }catch(err){ console.error(err); alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Web App ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
    }

    function renderFetchedPending(){
      const reportSection=document.getElementById("reportSection");
      const container = document.createElement('div');
      container.className='bg-white p-4 rounded shadow space-y-4 mt-4';
      if(!fetchedPending || fetchedPending.length===0){ container.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ pending ‡πÉ‡∏ô sheet</p>'; reportSection.appendChild(container); return; }
      fetchedPending.forEach((p, idx)=>{
        let html = `<div class="border-b pb-2"><p class="font-semibold">#${p.PendingID} - ${p.Timestamp}</p><ul class="ml-4">`;
        const items = JSON.parse(p.Items_JSON || '[]');
        items.forEach(it=>{ html+=`<li>${it.name}${it.size?(' ('+it.size+')'):''} x${it.qty} = ${it.price*it.qty} ‡∏ö‡∏≤‡∏ó</li>`; });
        html+=`</ul><p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${p.Total} ‡∏ö‡∏≤‡∏ó</p><div class="mt-2"><button onclick="confirmPendingOnSheet('${p.PendingID}','${idx}')" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Sheets</button></div></div>`;
        container.innerHTML += html;
      });
      reportSection.appendChild(container);
    }

    async function confirmPendingOnSheet(pendingId, idx){
      if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏•‡∏á Google Sheets ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      try{
        const res = await fetch(WEB_APP_URL, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ action: 'confirmPending', pendingId: pendingId }) });
        const j = await res.json().catch(()=>null);
        if(res.ok && j && j.status === 'success'){
          alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
          // remove from fetchedPending and re-render
          fetchedPending = fetchedPending.filter(p => String(p.PendingID) !== String(pendingId));
          renderFetchedPending();
          // also refresh local history
          renderHistory();
        } else {
          console.warn('confirmPendingOnSheet', res.status, j);
          alert('‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‚Äî ‡∏î‡∏π console');
        }
      }catch(err){ console.error(err); alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Web App ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
    }
    function renderHistory(){
      const historyContainer = document.getElementById("historyContainer");
      historyContainer.innerHTML = "";
      if(allOrders.length === 0){
        historyContainer.innerHTML = `<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>`;
        return;
      }

      allOrders.forEach((order, index) => {
        let itemsHtml = "";
        order.items.forEach(item => {
          const sizeText = item.size ? ` (${item.size})` : "";
          itemsHtml += `<li>${item.name}${sizeText} x${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
        });
        historyContainer.innerHTML += `
          <div class="border-b pb-2">
            <p class="font-semibold">üßæ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index + 1} - ${order.timestamp}</p>
            <ul class="ml-4 list-disc">${itemsHtml}</ul>
            <p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${order.total} ‡∏ö‡∏≤‡∏ó</p>
          </div>
        `;
      });
    }
    function confirmOrder(index) {
      const confirmed = confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
      if (!confirmed) return;
      // ‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å pendingOrders ‚Üí completedOrders
      completedOrders.push(pendingOrders[index]);
      pendingOrders.splice(index, 1);
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏á localStorage
      localStorage.setItem("pendingOrders", JSON.stringify(pendingOrders));
      localStorage.setItem("completedOrders", JSON.stringify(completedOrders));
       // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤
      updateReport();
      renderHistory();
    }

    // ---------- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ----------
    function initializeUserManagement() {
      const usersList = document.getElementById('usersList');
      const addUserForm = document.getElementById('addUserForm');

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      function updateUserStats() {
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        const adminCount = users.filter(u => u.role === 'admin').length;
        const staffCount = users.filter(u => u.role === 'staff').length;
        
        document.getElementById('totalUsers').textContent = users.length;
        document.getElementById('adminCount').textContent = adminCount;
        document.getElementById('staffCount').textContent = staffCount;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      function loadUsers() {
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        updateUserStats();
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        usersList.innerHTML = users.map(user => `
          <div class="bg-gray-50 p-4 rounded-lg flex flex-col">
            <div class="flex justify-between items-center mb-3">
              <div>
                <h4 class="font-medium text-lg">${user.role === 'admin' ? 'üëë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : 'üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'} (${user.username})</h4>
                <p class="text-sm text-gray-500 mt-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: ${user.password}</p>
                <div class="mt-2">
                  <span class="px-3 py-1 ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'} rounded-full text-sm font-medium">
                    ${user.role === 'admin' ? 'Admin' : 'Staff'}
                  </span>
                </div>
              </div>
              <div>
                <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">Active</span>
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              <button onclick="testLogin('${user.username}', '${user.password}', '${user.role}')" 
                      class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
              </button>
              <button onclick="editUserPassword('${user.username}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
              </button>
              <button onclick="changeUserRole('${user.username}', '${user.role}')" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                </svg>
                ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
              </button>
              <button onclick="deleteUser('${user.username}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                ‡∏•‡∏ö
              </button>
            </div>
          </div>
        `).join('');
      }

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      addUserForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('newUsername').value.trim();
        const password = document.getElementById('newPassword').value.trim();
        const roleInputs = document.getElementsByName('newRole');
        let role = '';
        
        for (const input of roleInputs) {
          if (input.checked) {
            role = input.value;
            break;
          }
        }

        if (!username || !password || !role) {
          alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
          return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        if (username.length < 3) {
          alert('‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
          return;
        }

        if (password.length < 3) {
          alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
          return;
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (users.some(u => u.username === username)) {
          alert('‚ùå ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
          return;
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
        users.push({ username, password, role });
        localStorage.setItem('restaurant_users', JSON.stringify(users));
        
        const roleText = role === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
        alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ "${username}" (${roleText}) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
        this.reset();
        loadUsers();
      });

      // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      loadUsers();

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
      window.editUserPassword = function(username) {
        const newPassword = prompt('‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà:');
        if (!newPassword) return;

        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        const userIndex = users.findIndex(u => u.username === username);
        
        if (userIndex !== -1) {
          users[userIndex].password = newPassword;
          localStorage.setItem('restaurant_users', JSON.stringify(users));
          alert('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          loadUsers(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        }
      };

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      window.changeUserRole = function(username, currentRole) {
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        const user = users.find(u => u.username === username);
        
        if (!user) {
          alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ');
          return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (currentRole === 'admin') {
          const adminCount = users.filter(u => u.role === 'admin').length;
          if (adminCount <= 1) {
            alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ');
            return;
          }
        }

        const newRole = currentRole === 'admin' ? 'staff' : 'admin';
        const roleText = newRole === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
        
        if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á "${username}" ‡πÄ‡∏õ‡πá‡∏ô "${roleText}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
          return;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
        const userIndex = users.findIndex(u => u.username === username);
        users[userIndex].role = newRole;
        localStorage.setItem('restaurant_users', JSON.stringify(users));
        
        alert(`‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡πá‡∏ô "${roleText}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
        loadUsers(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      };

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      window.deleteUser = function(username) {
        if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ?')) return;

        let users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        
        // ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        const remainingAdmins = users.filter(u => u.role === 'admin' && u.username !== username);
        if (users.find(u => u.username === username)?.role === 'admin' && remainingAdmins.length === 0) {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ');
          return;
        }

        users = users.filter(u => u.username !== username);
        localStorage.setItem('restaurant_users', JSON.stringify(users));
        loadUsers();
        alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      };
    }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
    window.testLogin = function(username, password, role) {
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• redirect ‡πÅ‡∏•‡∏∞ session ‡πÄ‡∏Å‡πà‡∏≤
      sessionStorage.clear();
        sessionStorage.removeItem('restaurant_current_user');
      
      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö popup window
      const testWindow = window.open('index.html', 'testLogin', 
        'width=500,height=600,resizable=yes,scrollbars=yes,status=yes');
      
      if (!testWindow) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï popup window');
        return;
      }
      
      testWindow.onload = function() {
        try {
          testWindow.document.getElementById('username').value = username;
          testWindow.document.getElementById('password').value = password;
          const roleInput = testWindow.document.querySelector(`input[name="role"][value="${role}"]`);
          if (roleInput) roleInput.checked = true;
        } catch (e) {
          console.error('Error setting login form values:', e);
        }
      };
    };

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    window.addEventListener('load', initializeUserManagement);

  function loadUsers() {
      const usersList = document.getElementById('usersList');
      if (typeof getUsers === 'function') {
        const users = getUsers();
        usersList.innerHTML = users.map(user => `
          <div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center">
            <div>
              <h4 class="font-medium">${user.role === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'} (${user.username})</h4>
              <div class="mt-2 space-x-2">
                <button onclick="editUser('${user.username}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button onclick="deleteUser('${user.username}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">‡∏•‡∏ö</button>
              </div>
            </div>
            <div class="flex space-x-2">
              <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm">Active</span>
            </div>
          </div>
        `).join('');
      } else {
        usersList.innerHTML = '<p class="text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</p>';
      }
    }

    function editUser(username) {
      const newPassword = prompt('‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ' + username + ':\n(‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)');
      if (newPassword === null) return; // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Cancel
      
      if (typeof updateUser === 'function') {
        const success = updateUser(username, newPassword);
        if (success) {
          alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          loadUsers();
        } else {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ');
        }
      }
    }

    function deleteUser(username) {
      if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ' + username + ' ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      
      if (typeof removeUser === 'function') {
        const success = removeUser(username);
        if (success) {
          alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          loadUsers();
        } else {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ');
        }
      }
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Users Section
    document.querySelector('button[onclick="showSection(\'users\')"]')?.addEventListener('click', loadUsers);

    // ---------- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ----------
    function renderHistory(){
      const historyContainer = document.getElementById("historyContainer");
      historyContainer.innerHTML = "";
      if(completedOrders.length === 0){
        historyContainer.innerHTML = `<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>`;
        return;
      }

      completedOrders.forEach((order, index) => {
        let itemsHtml = "";
        order.items.forEach(item => {
          const sizeText = item.size ? ` (${item.size})` : "";
          itemsHtml += `<li>${item.name}${sizeText} x${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
        });
        historyContainer.innerHTML += `
        <div class="border-b pb-2 mb-2">
          <p class="font-semibold">üßæ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index + 1} - ${order.timestamp}</p>
          <ul class="ml-4 list-disc">${itemsHtml}</ul>
          <p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${order.total} ‡∏ö‡∏≤‡∏ó</p>
        </div>
      `;
    });
  }

    // ---------- Sidebar + Logout ----------
  // use logout() from auth.js which clears current user and redirects
    function toggleSidebar(){
      const sidebar=document.getElementById("sidebar");
      sidebar.classList.toggle("sidebar-collapsed");
      sidebar.classList.toggle("w-16");
      sidebar.classList.toggle("w-64");
      if(sidebar.classList.contains("w-16")){
        orderSummary.style.left="4rem"; orderSummary.style.width="calc(100% - 4rem)";
      } else {
        orderSummary.style.left="16rem"; orderSummary.style.width="calc(100% - 16rem)";
      }
    }
    function showSection(section){
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å section
      document.getElementById("menuSection").classList.add("hidden");
      document.getElementById("orderSection").classList.add("hidden");
      document.getElementById("reportSection").classList.add("hidden");
      document.getElementById("historySection").classList.add("hidden");
      document.getElementById("usersSection").classList.add("hidden");
      
      // ‡πÅ‡∏™‡∏î‡∏á section ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      if(section==="menu") document.getElementById("menuSection").classList.remove("hidden");
      if(section==="order") document.getElementById("orderSection").classList.remove("hidden");
      if(section==="report") document.getElementById("reportSection").classList.remove("hidden");
      if(section==="history"){ 
        document.getElementById("historySection").classList.remove("hidden");
        renderHistory(); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
      }
      if(section==="users") {
        console.log('Showing users section');
        document.getElementById("usersSection").classList.remove("hidden");
        if(typeof loadUsers === 'function') {
          console.log('loadUsers function exists, calling it');
          loadUsers();
        } else {
          console.error('loadUsers function not found! Check if auth.js is loaded correctly');
        }
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const users = getUsers();
        console.log('Current users:', users);
      }
    }
    updateReport();
  </script>
</body>
</html>