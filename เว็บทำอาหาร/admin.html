<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KAOBAOWAN - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
  <script src="auth.js"></script>
  <script>
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ auth.js ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    window.addEventListener('load', function() {
      if (typeof getUsers === 'function') {
        console.log('auth.js loaded successfully');
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
        const users = getUsers();
        console.log('Initial users:', users);
      } else {
        console.error('auth.js not loaded correctly!');
      }
    });
  </script>
  <style>
    body { 
      font-family: 'Prompt', sans-serif;
      background-color: #FAF9F7;
      color: #2F2F2F;
      font-weight: 400;
    }
    .sidebar-text {
      transition: opacity 200ms, transform 200ms;
      white-space: nowrap;
    }
    .sidebar-collapsed .sidebar-text {
      opacity: 0;
      transform: translateX(-20px);
      display: none;
    }
    .btn-primary {
      background-color: #D8504C;
      transition: all 200ms ease;
    }
    .btn-primary:hover {
      background-color: #FBEAEA;
      color: #D8504C;
    }
    .btn-secondary {
      border: 1px solid #E5E4E2;
      color: #2F2F2F;
      transition: all 200ms ease;
    }
    .btn-secondary:hover {
      background-color: #FBEAEA;
      border-color: #D8504C;
      color: #D8504C;
    }
    .card-hover {
      transition: all 200ms ease;
    }
    .card-hover:hover {
      background-color: #FBEAEA;
    }
  </style>
</head>
<body class="flex"></body>

  <!-- Sidebar -->
  <aside id="sidebar" class="h-screen p-5 flex flex-col transition-all duration-300 w-64" style="background-color: #F3F2EF; border-right: 1px solid #E5E4E2;">
    <button onclick="toggleSidebar()" class="mb-4 p-2 rounded-xl transition" style="border: 1px solid #E5E4E2; color: #2F2F2F;">‚ò∞</button>
    <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ KAOBAOWAN -->
    <div class="mb-8 text-center sidebar-text">
      <img src="‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πÇ‡∏Å‡πâ/‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏°.png" alt="KAOBAOWAN" class="w-20 h-20 mx-auto mb-3 opacity-90">
      <h1 class="text-base" style="color: #D8504C; font-weight: 600;">Admin Panel</h1>
      <p class="text-xs mt-1 opacity-60" style="color: #2F2F2F;">KAOBAOWAN</p>
    </div>
    <nav class="flex flex-col space-y-1">
      <button onclick="showSection('menu')" class="flex items-center gap-3 py-3 px-4 rounded-xl transition text-left" style="color: #2F2F2F;">
        <span>üçî</span>
        <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('order')" class="flex items-center gap-3 py-3 px-4 rounded-xl transition text-left" style="color: #2F2F2F;">
        <span>üõí</span>
        <span class="sidebar-text">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
      </button>
      <button onclick="showSection('report')" class="flex items-center gap-3 py-3 px-4 rounded-xl transition text-left" style="color: #2F2F2F;">
        <span>üí∞</span>
        <span class="sidebar-text">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
      </button>
      <button onclick="showSection('history')" class="flex items-center gap-3 py-3 px-4 rounded-xl transition text-left" style="color: #2F2F2F;">
        <span>üìú</span>
        <span class="sidebar-text">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
      </button>
      <button onclick="showSection('users')" class="flex items-center gap-3 py-3 px-4 rounded-xl transition text-left" style="color: #2F2F2F;">
        <span>üë•</span>
        <span class="sidebar-text">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
      </button>
      <button onclick="logout()" class="flex items-center gap-3 btn-primary text-white py-3 px-4 rounded-xl mt-auto" style="font-weight: 600;">
        <span>üö™</span>
        <span class="sidebar-text">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
      </button>

    </nav>
  </aside>

  <!-- Main content -->
  <main id="mainContent" class="flex-1 p-6 transition-all duration-300">

    <!-- Section ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Admin) -->
    <section id="menuSection">
      <!-- ‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
      <div class="flex gap-2 mb-4">
        <button onclick="showMenuTab('menu')" id="menuTab" class="px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold">
          üçî ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π
        </button>
        <button onclick="showMenuTab('promo')" id="promoTab" class="px-4 py-2 rounded-lg bg-gray-300 text-gray-900 font-semibold hover:bg-gray-400">
          üî• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
        </button>
      </div>

      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π -->
      <div id="menuManagement">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
          <div class="flex gap-2">
            <button onclick="saveMenu(); alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° \'‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π\' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
              </svg>
              ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π
            </button>
            <span class="bg-gray-100 px-4 py-2 rounded-lg text-gray-700 flex items-center">
              üìã ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="menuCount" class="font-bold ml-2">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </span>
          </div>
        </div>

      <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏ô‡∏π (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ) -->
      <div id="editMenuForm" class="hidden mb-6 rounded-xl p-6" style="background-color: #FFE7A0; border: 2px solid #D8504C;">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold" style="color: #D8504C;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏ô‡∏π</h3>
          <button onclick="cancelEdit()" class="text-gray-600 hover:text-red-600 font-bold text-2xl">&times;</button>
        </div>
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1" style="color: #2F2F2F;">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
            <input type="text" id="editMenuName" class="w-full px-4 py-3 rounded-xl" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1" style="color: #2F2F2F;">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
            <input type="number" id="editMenuPrice" class="w-full px-4 py-3 rounded-xl" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
          </div>
        </div>
        
        <div class="mt-4">
          <label class="block text-sm font-medium mb-2" style="color: #2F2F2F;">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
          <div class="flex gap-3 mb-3">
            <label class="inline-flex items-center">
              <input type="radio" name="editImageSource" value="none" checked>
              <span class="ml-2">‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="editImageSource" value="url">
              <span class="ml-2">‡πÉ‡∏ä‡πâ URL</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="editImageSource" value="file">
              <span class="ml-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="editImageSource" value="remove">
              <span class="ml-2">‡∏•‡∏ö‡∏£‡∏π‡∏õ</span>
            </label>
          </div>
          <input type="text" id="editImageUrl" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)" class="w-full px-4 py-3 rounded-xl hidden mb-2" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
          <input type="file" id="editImageFile" accept="image/*" class="w-full px-4 py-3 rounded-xl hidden mb-2" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
          <img id="editPreviewImage" src="" alt="Preview" class="w-32 h-32 object-cover rounded-xl mt-2 hidden" style="border: 2px solid #E5E4E2;">
        </div>
        
        <div class="flex gap-3 mt-6">
          <button onclick="saveEditMenu()" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold flex-1">
            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
          </button>
          <button onclick="cancelEdit()" class="btn-secondary px-6 py-3 rounded-xl font-semibold">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
        </div>
      </div>
      <div class="overflow-x-auto bg-white rounded-xl shadow-md mb-6">
        <table class="min-w-full border-collapse">
          <thead class="bg-indigo-100">
            <tr>
              <th class="p-3 border">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
              <th class="p-3 border">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
              <th class="p-3 border">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
              <th class="p-3 border">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody id="menuTable"></tbody>
        </table>
      </div>
      <div class="bg-white shadow-md rounded-xl p-4">
        <h3 class="text-lg font-semibold mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà</h3>
        <form id="addMenuForm" class="grid md:grid-cols-3 gap-3">
          <input type="text" id="menuName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π" class="border p-2 rounded" required>
          <input type="number" id="menuPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="border p-2 rounded" required>

          <div class="flex flex-col gap-2 md:col-span-3">
            <label class="block text-sm font-medium">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏°‡∏ô‡∏π (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
            <div class="flex items-center gap-4">
              <label class="inline-flex items-center"><input type="radio" name="imageSource" id="imageSrcNone" value="none" checked> <span class="ml-2">‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ</span></label>
              <label class="inline-flex items-center"><input type="radio" name="imageSource" id="imageSrcUrl" value="url"> <span class="ml-2">‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå</span></label>
              <label class="inline-flex items-center"><input type="radio" name="imageSource" id="imageSrcFile" value="file"> <span class="ml-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span></label>
            </div>

            <input type="text" id="menuImageUrl" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)" class="border p-2 rounded hidden">
            <input type="file" id="menuImageFile" accept="image/*" class="border p-2 rounded hidden">
            <div class="text-sm text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>
          </div>

          <div class="md:col-span-3 flex items-center gap-4">
            <img id="previewImage" src="" alt="Preview" class="w-24 h-24 object-cover rounded hidden cursor-pointer" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢">
            <div>
              <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
            </div>
          </div>

        </form>
      </div>
      </div>

      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
      <div id="promoManagement" class="hidden">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h2>
          <div class="flex gap-2">
            <button onclick="savePromos(); alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° \'‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π\' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
              </svg>
              ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
            </button>
            <span class="bg-gray-100 px-4 py-2 rounded-lg text-gray-700 flex items-center">
              üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="promoCount" class="font-bold ml-2">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </span>
          </div>
        </div>

        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ) -->
        <div id="editPromoForm" class="hidden mb-6 rounded-2xl p-6" style="background-color: #F3F2EF; border: 2px solid #D8504C;">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-semibold" style="color: #D8504C;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h3>
            <button onclick="cancelEditPromo()" class="text-gray-600 hover:text-red-600 font-bold text-3xl leading-none">&times;</button>
          </div>
          
          <div class="grid md:grid-cols-2 gap-6 mb-6">
            <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-semibold mb-2" style="color: #2F2F2F;">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</label>
                <input type="text" id="editPromoName" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡∏ä‡∏¥‡πâ‡∏ô" class="w-full px-4 py-3 rounded-xl" style="border: 1px solid #E5E4E2; background-color: #FAF9F7; font-size: 16px;">
              </div>
              
              <div>
                <label class="block text-sm font-semibold mb-2" style="color: #2F2F2F;">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</label>
                <div class="grid grid-cols-2 gap-2 mb-3">
                  <label class="flex items-center p-3 rounded-xl cursor-pointer transition" style="border: 2px solid #E5E4E2; background-color: #FAF9F7;">
                    <input type="radio" name="editPromoImageSource" value="none" checked class="mr-2">
                    <span class="text-sm">‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</span>
                  </label>
                  <label class="flex items-center p-3 rounded-xl cursor-pointer transition" style="border: 2px solid #E5E4E2; background-color: #FAF9F7;">
                    <input type="radio" name="editPromoImageSource" value="url" class="mr-2">
                    <span class="text-sm">‡πÉ‡∏ä‡πâ URL</span>
                  </label>
                  <label class="flex items-center p-3 rounded-xl cursor-pointer transition" style="border: 2px solid #E5E4E2; background-color: #FAF9F7;">
                    <input type="radio" name="editPromoImageSource" value="file" class="mr-2">
                    <span class="text-sm">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span>
                  </label>
                  <label class="flex items-center p-3 rounded-xl cursor-pointer transition" style="border: 2px solid #E5E4E2; background-color: #FAF9F7;">
                    <input type="radio" name="editPromoImageSource" value="remove" class="mr-2">
                    <span class="text-sm">‡∏•‡∏ö‡∏£‡∏π‡∏õ</span>
                  </label>
                </div>
                <input type="text" id="editPromoImageUrl" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)" class="w-full px-4 py-3 rounded-xl hidden mb-2" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
                <input type="file" id="editPromoImageFile" accept="image/*" class="w-full px-4 py-3 rounded-xl hidden mb-2" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
                <img id="editPromoPreviewImage" src="" alt="Preview" class="w-full h-40 object-cover rounded-xl mt-3 hidden" style="border: 2px solid #E5E4E2;">
              </div>
            </div>
            
            <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏ß‡∏≤: ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
            <div>
              <label class="block text-sm font-semibold mb-2" style="color: #2F2F2F;">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</label>
              <div class="rounded-xl p-4 mb-3" style="background-color: #FAF9F7; border: 1px solid #E5E4E2; max-height: 400px; overflow-y: auto;">
                <div id="editPromoOptionsContainer" class="space-y-2">
                  <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
              </div>
              <button type="button" onclick="addEditPromoOption()" class="w-full btn-primary text-white px-4 py-3 rounded-xl font-semibold">
                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
              </button>
            </div>
          </div>
          
          <div class="flex gap-3">
            <button onclick="saveEditPromo()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold flex-1" style="font-size: 16px;">
              üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            </button>
            <button onclick="cancelEditPromo()" class="btn-secondary px-8 py-3 rounded-xl font-semibold" style="font-size: 16px;">
              ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>
        </div>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
        <div class="overflow-x-auto bg-white rounded-xl shadow-md mb-6">
          <table class="min-w-full border-collapse">
            <thead class="bg-orange-100">
              <tr>
                <th class="p-3 border">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                <th class="p-3 border">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</th>
                <th class="p-3 border">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</th>
                <th class="p-3 border">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="promoTable"></tbody>
          </table>
        </div>

        <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) -->
        <div class="bg-white shadow-md rounded-xl p-4">
          <h3 class="text-lg font-semibold mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
          
          <!-- ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</label>
            <input type="text" id="promoGroupName" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡∏ä‡∏¥‡πâ‡∏ô" class="w-full border-2 p-2 rounded-lg" required>
          </div>
          
          <!-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
            <div class="flex items-center gap-4 mb-2">
              <label class="inline-flex items-center">
                <input type="radio" name="promoImageSource" id="promoImageNone" value="none" checked>
                <span class="ml-2">‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏£‡∏π‡∏õ</span>
              </label>
              <label class="inline-flex items-center">
                <input type="radio" name="promoImageSource" id="promoImageUrl" value="url">
                <span class="ml-2">‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå</span>
              </label>
              <label class="inline-flex items-center">
                <input type="radio" name="promoImageSource" id="promoImageFile" value="file">
                <span class="ml-2">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</span>
              </label>
            </div>
            
            <input type="text" id="promoImageUrlInput" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)" class="w-full border p-2 rounded hidden mb-2">
            <input type="file" id="promoImageFileInput" accept="image/*" class="w-full border p-2 rounded hidden mb-2">
            
            <img id="promoPreviewImage" src="" alt="Preview" class="w-24 h-24 object-cover rounded hidden cursor-pointer mt-2" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢">
          </div>
          
          <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</label>
            <div id="promoOptionsContainer" class="space-y-2">
              <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
            <button type="button" onclick="addPromoOption()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm">
              ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            </button>
          </div>
          
          <div class="flex gap-2">
            <button onclick="saveNewPromo()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-semibold">
              üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
            </button>
            <button onclick="clearPromoForm()" class="bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500">
              üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            </button>
          </div>
          
          <div class="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
            <strong>üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong><br>
            ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: "‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡∏ä‡∏¥‡πâ‡∏ô"<br>
            ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1: "3 ‡∏ä‡∏¥‡πâ‡∏ô" ‡∏£‡∏≤‡∏Ñ‡∏≤ 39 ‡∏ö‡∏≤‡∏ó<br>
            ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2: "6 ‡∏ä‡∏¥‡πâ‡∏ô" ‡∏£‡∏≤‡∏Ñ‡∏≤ 79 ‡∏ö‡∏≤‡∏ó<br>
            ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 3: "10 ‡∏ä‡∏¥‡πâ‡∏ô" ‡∏£‡∏≤‡∏Ñ‡∏≤ 129 ‡∏ö‡∏≤‡∏ó
          </div>
        </div>
      </div>
    </section>

    <!-- Section ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ + ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
    <section id="orderSection" class="hidden">
      <h2 class="text-2xl font-semibold mb-4">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>

      <!-- ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô -->
      <section id="promoSection" class="mb-6">
        <h3 class="text-xl font-semibold mb-2">üî• ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h3>
        <div id="promoContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-4"></div>
      </section>

      <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏Å‡∏ï‡∏¥ -->
      <div id="orderMenuContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-6"></div>

      <!-- Order Summary -->
      <div id="orderSummary" class="fixed bottom-0 left-64 w-[calc(100%-16rem)] bg-white shadow-md border-t border-gray-200 p-4 hidden">
        <h2 class="text-lg font-semibold mb-2">üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
        <ul id="orderList" class="text-gray-700 mb-2"></ul>
        <p class="font-semibold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</p>
        <button onclick="submitOrder()" class="mt-2 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
      </div>
    </section>

    <!-- Section ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ -->
    <section id="reportSection" class="hidden"></section>

    <!-- Section ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
    <section id="usersSection" class="hidden">
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
          <div class="flex items-center gap-2 bg-green-50 px-4 py-2 rounded-lg border border-green-200">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-sm text-green-700 font-medium">Real-time Updates</span>
          </div>
        </div>
        
        <!-- Google Sheets Link -->
        <div class="mb-6 bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-200 rounded-lg p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              <div>
                <h3 class="font-bold text-lg text-gray-800">Google Sheets</h3>
                <p class="text-sm text-gray-600">‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                <p class="text-3xl font-bold" id="totalUsers">0</p>
              </div>
              <svg class="w-12 h-12 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
            </div>
          </div>
          <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                <p class="text-3xl font-bold" id="adminCount">0</p>
              </div>
              <svg class="w-12 h-12 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
            </div>
          </div>
          <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm opacity-90">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
                <p class="text-3xl font-bold" id="staffCount">0</p>
              </div>
              <svg class="w-12 h-12 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- Debug Panel ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß -->
        <div id="debugPanel" class="mb-6 bg-gray-900 text-white rounded-lg p-6 hidden" style="display: none !important;">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold flex items-center gap-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
              </svg>
              üîç Debug Online Status
            </h3>
            <button onclick="toggleDebugPanel()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg">
              ‡∏õ‡∏¥‡∏î
            </button>
          </div>
          
          <div class="bg-green-900 border-l-4 border-green-500 text-green-100 p-4 mb-4 rounded">
            <p class="font-bold">‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Real-time</p>
            <p class="text-sm mt-1">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | ‡πÄ‡∏Å‡∏ì‡∏ë‡πå Online: 2 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
          </div>
          
          <div id="debugStatusDisplay" class="space-y-4">
            <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
          </div>
        </div>
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà -->
        <div class="mb-8 bg-gradient-to-r from-gray-50 to-gray-100 p-6 rounded-lg border-2 border-dashed border-gray-300">
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
          </h3>
          <form id="addUserForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                <input type="text" id="newUsername" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="w-full p-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none" required>
              </div>
              <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <input type="password" id="newPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none" required>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
              <div class="grid grid-cols-2 gap-4">
                <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition">
                  <input type="radio" name="newRole" id="newRoleStaff" value="staff" required class="mr-3 w-4 h-4">
                  <div>
                    <span class="font-medium">üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</span>
                    <p class="text-xs text-gray-500">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                  </div>
                </label>
                <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition">
                  <input type="radio" name="newRole" id="newRoleAdmin" value="admin" required class="mr-3 w-4 h-4">
                  <div>
                    <span class="font-medium">üëë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</span>
                    <p class="text-xs text-gray-500">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå</p>
                  </div>
                </label>
              </div>
            </div>
            <button type="submit" class="bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-6 rounded-lg hover:from-green-600 hover:to-green-700 w-full font-medium shadow-lg hover:shadow-xl transition flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            </button>
          </form>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div>
          <h3 class="text-lg font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </h3>
          <div class="grid grid-cols-1 gap-4" id="usersList">
            <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
          </div>
        </div>
      </div>
    </section>

    <!-- Section ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß -->
    <section id="historySection" class="hidden">
      <h2 class="text-2xl font-semibold mb-4">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</h2>

      <button onclick="clearAllHistory()"
        class="mb-4 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
        üóëÔ∏è ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ö‡∏¥‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      </button>
      <div id="historyContainer" class="bg-white p-4 rounded shadow space-y-4"></div>
    </section>


  </main>

  <script>
    // ---------- Google Sheets Configuration ----------
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç WEB_APP_URL ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Deploy Apps Script ‡πÅ‡∏•‡πâ‡∏ß
    const GOOGLE_SHEETS_URL = "https://docs.google.com/spreadsheets/d/1A-7GALat0kpHk4FKc5CVW5EBYs5x3dbCjudG57OaeNg/edit?gid=0#gid=0"; // URL ‡∏Ç‡∏≠‡∏á Google Sheets
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzDAWCVeSEoXg3yLEEiUXkTUHQV2ZpRHQCu4bJYtQHjtqdXfGrPJcPzG-wvMvXa088Z/exec"; // URL ‡∏Ç‡∏≠‡∏á Web App
    
    // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ auth.js ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á WEB_APP_URL ‡πÑ‡∏î‡πâ
    window.WEB_APP_URL = WEB_APP_URL;
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Google Sheets
    function openGoogleSheets() {
      if (GOOGLE_SHEETS_URL && !GOOGLE_SHEETS_URL.includes('YOUR_SPREADSHEET_ID')) {
        window.open(GOOGLE_SHEETS_URL, '_blank');
      } else {
        alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets URL ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå admin.html\n\n‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: GOOGLE_SHEETS_URL\n‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Sheets ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
      }
    }
    
    // ---------- ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏Å‡∏ï‡∏¥ ----------
    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    let menuItems = [];
    
    function loadMenuData() {
      const savedMenu = localStorage.getItem("menuData");
      if (savedMenu) {
        menuItems = JSON.parse(savedMenu);
        console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å localStorage ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + menuItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)');
      } else {
        // ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        menuItems = [
          { id: 1, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÄ‡∏•‡πá‡∏Å", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
          { id: 2, name: "‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
          { id: 3, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÉ‡∏´‡∏ç‡πà", price: 29, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" },
          { id: 4, name: "‡πÑ‡∏Å‡πà‡πÑ‡∏£‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å", price: 12, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" },
          { id: 5, name: "‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÑ‡∏Å‡πà", price: 39, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          { id: 6, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î‡πÄ‡∏Å‡πä‡∏≤", price: 49, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          { id: 7, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î‡πÄ‡∏Å‡πä‡∏≤ + ‡∏ã‡∏≠‡∏™‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ", price: 59, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå & ‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å ---
          {id:201, name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå S", price:29, img:"https://cdn-icons-png.flaticon.com/512/1046/1046784.png", size:"S"},
          {id:202, name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå M", price:39, img:"https://cdn-icons-png.flaticon.com/512/1046/1046784.png", size:"M"},
          {id:203, name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå L", price:49, img:"https://cdn-icons-png.flaticon.com/512/1046/1046784.png", size:"L"},
          {id:204, name:"‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å S", price:20, img:"https://cdn-icons-png.flaticon.com/512/1046/1046785.png", size:"S"},
          {id:205, name:"‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å M", price:30, img:"https://cdn-icons-png.flaticon.com/512/1046/1046785.png", size:"M"},
          {id:206, name:"‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å L", price:40, img:"https://cdn-icons-png.flaticon.com/512/1046/1046785.png", size:"L"}
        ];
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏•‡∏á localStorage
        saveMenu();
        console.log('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage');
      }
    }
    
    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    loadMenuData();

    let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
    let pendingOrders = JSON.parse(localStorage.getItem("pendingOrders")) || [];
    let completedOrders = JSON.parse(localStorage.getItem("completedOrders")) || [];
    const menuTable = document.getElementById("menuTable");
    const addMenuForm = document.getElementById("addMenuForm");
    const orderMenuContainer = document.getElementById("orderMenuContainer");
    const orderSummary = document.getElementById("orderSummary");
    const orderList = document.getElementById("orderList");
    const totalDisplay = document.getElementById("total");
    let order = [];

    // ---------- Admin: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π ----------
    function renderTable(){
      menuTable.innerHTML="";
      menuItems.forEach((item,index)=>{
        const imageHtml = item.img 
          ? `<img src="${item.img}" class="w-16 h-16 mx-auto object-cover rounded">` 
          : '<div class="w-16 h-16 mx-auto bg-gray-200 rounded flex items-center justify-center text-gray-400 text-xs">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>';
        menuTable.innerHTML+=`
          <tr class="text-center">
            <td class="border p-2">${imageHtml}</td>
            <td class="border p-2">${item.name}</td>
            <td class="border p-2">${item.price}</td>
            <td class="border p-2">
              <button onclick="editMenu(${index})" class="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deleteMenu(${index})" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600">‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      });
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡∏ô‡∏π
      const menuCountEl = document.getElementById('menuCount');
      if (menuCountEl) menuCountEl.textContent = menuItems.length;
    }
    renderTable();

    addMenuForm.addEventListener("submit", e=>{
      e.preventDefault();
      const name=document.getElementById("menuName").value.trim();
      const price=parseFloat(document.getElementById("menuPrice").value);
      // determine image source
      const imageSource = document.querySelector('input[name="imageSource"]:checked').value;
      let img = '';
      
      if (imageSource === 'url') {
        img = document.getElementById('menuImageUrl').value.trim();
      } else if (imageSource === 'file') {
        img = window._lastMenuImageDataUrl || '';
      }
      // if imageSource === 'none', img stays empty
      
      if(!name||!price) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤");
      menuItems.push({id:Date.now(),name,price,img});
      renderTable(); saveMenu(); renderOrderMenu(); renderPromos(); addMenuForm.reset();
      const preview = document.getElementById('previewImage'); preview.src=''; preview.classList.add('hidden');
      // reset file cache and radio to none
      window._lastMenuImageDataUrl = null;
      document.getElementById('imageSrcNone').checked = true;
      document.getElementById('menuImageUrl').classList.add('hidden');
      document.getElementById('menuImageFile').classList.add('hidden');
    });

    // preview image when URL entered
    document.getElementById('menuImageUrl').addEventListener('input', function(){
      const val = this.value.trim(); const preview = document.getElementById('previewImage');
      if(val){ preview.src = val; preview.classList.remove('hidden'); } else { preview.src=''; preview.classList.add('hidden'); }
    });

    // file input preview
    document.getElementById('menuImageFile').addEventListener('change', function(){
      const file = this.files && this.files[0];
      const preview = document.getElementById('previewImage');
      if(!file){ preview.src=''; preview.classList.add('hidden'); window._lastMenuImageDataUrl = null; return; }
      const reader = new FileReader();
      reader.onload = function(ev){
        const dataUrl = ev.target.result;
        window._lastMenuImageDataUrl = dataUrl;
        preview.src = dataUrl; preview.classList.remove('hidden');
      };
      reader.readAsDataURL(file);
    });

    // toggle between none/url/file inputs
    document.getElementById('imageSrcNone').addEventListener('change', function(){
      if(this.checked){ 
        document.getElementById('menuImageUrl').classList.add('hidden'); 
        document.getElementById('menuImageFile').classList.add('hidden');
        document.getElementById('previewImage').classList.add('hidden');
      }
    });
    document.getElementById('imageSrcUrl').addEventListener('change', function(){
      if(this.checked){ 
        document.getElementById('menuImageUrl').classList.remove('hidden'); 
        document.getElementById('menuImageFile').classList.add('hidden'); 
      }
    });
    document.getElementById('imageSrcFile').addEventListener('change', function(){
      if(this.checked){ 
        document.getElementById('menuImageUrl').classList.add('hidden'); 
        document.getElementById('menuImageFile').classList.remove('hidden'); 
      }
    });

    // preview click to open full image in new window
    document.getElementById('previewImage').addEventListener('click', function(){ if(this.src) window.open(this.src, '_blank'); });

    let editingIndex = -1;
    
    function editMenu(index){
      editingIndex = index;
      const item = menuItems[index];
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      document.getElementById('editMenuForm').classList.remove('hidden');
      document.getElementById('editMenuName').value = item.name;
      document.getElementById('editMenuPrice').value = item.price;
      
      // ‡πÅ‡∏™‡∏î‡∏á preview ‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const preview = document.getElementById('editPreviewImage');
      if(item.img) {
        preview.src = item.img;
        preview.classList.remove('hidden');
      } else {
        preview.classList.add('hidden');
      }
      
      // Reset radio buttons
      document.querySelector('input[name="editImageSource"][value="none"]').checked = true;
      document.getElementById('editImageUrl').classList.add('hidden');
      document.getElementById('editImageFile').classList.add('hidden');
      
      // Scroll to form
      document.getElementById('editMenuForm').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function cancelEdit() {
      editingIndex = -1;
      document.getElementById('editMenuForm').classList.add('hidden');
      document.getElementById('editImageUrl').value = '';
      document.getElementById('editImageFile').value = '';
      document.getElementById('editPreviewImage').classList.add('hidden');
    }
    
    function saveEditMenu() {
      if(editingIndex === -1) return;
      
      const item = menuItems[editingIndex];
      const newName = document.getElementById('editMenuName').value.trim();
      const newPrice = parseFloat(document.getElementById('editMenuPrice').value);
      
      if(!newName || !newPrice) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤');
        return;
      }
      
      item.name = newName;
      item.price = newPrice;
      
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      const imageSource = document.querySelector('input[name="editImageSource"]:checked').value;
      
      if(imageSource === 'url') {
        const url = document.getElementById('editImageUrl').value.trim();
        if(url) item.img = url;
      } else if(imageSource === 'file') {
        const file = document.getElementById('editImageFile').files[0];
        if(file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            item.img = e.target.result;
            finishEdit();
          };
          reader.readAsDataURL(file);
          return; // ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏£‡πá‡∏à
        }
      } else if(imageSource === 'remove') {
        item.img = '';
      }
      // imageSource === 'none' ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
      
      finishEdit();
    }
    
    function finishEdit() {
      renderTable();
      saveMenu();
      renderOrderMenu();
      renderPromos();
      cancelEdit();
      alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }
    
    // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    document.querySelectorAll('input[name="editImageSource"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const urlInput = document.getElementById('editImageUrl');
        const fileInput = document.getElementById('editImageFile');
        
        if(this.value === 'url') {
          urlInput.classList.remove('hidden');
          fileInput.classList.add('hidden');
        } else if(this.value === 'file') {
          urlInput.classList.add('hidden');
          fileInput.classList.remove('hidden');
        } else {
          urlInput.classList.add('hidden');
          fileInput.classList.add('hidden');
        }
      });
    });
    
    // Preview ‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å URL
    document.getElementById('editImageUrl').addEventListener('input', function() {
      const preview = document.getElementById('editPreviewImage');
      if(this.value.trim()) {
        preview.src = this.value.trim();
        preview.classList.remove('hidden');
      }
    });
    
    // Preview ‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå
    document.getElementById('editImageFile').addEventListener('change', function() {
      const file = this.files[0];
      const preview = document.getElementById('editPreviewImage');
      if(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    function deleteMenu(index){
      if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")){
        menuItems.splice(index,1);
        renderTable(); saveMenu(); renderOrderMenu(); renderPromos();
      }
    }

    function saveMenu(){ 
      localStorage.setItem("menuData",JSON.stringify(menuItems)); 
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å timestamp ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
      const timestamp = Date.now();
      localStorage.setItem("menuDataTimestamp", timestamp.toString());
      console.log('‚úÖ ‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + menuItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)');
      
      // ‡∏™‡πà‡∏á Custom Event ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
      try {
        window.dispatchEvent(new CustomEvent('menuUpdated', { 
          detail: { count: menuItems.length, timestamp: timestamp } 
        }));
      } catch(e) {
        console.log('Custom event not supported');
      }
      
      // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
      showMenuUpdateNotification();
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π
    function showMenuUpdateNotification() {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2';
      notification.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß (${menuItems.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.3s';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    // ---------- ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Staff-like) ----------
    function renderOrderMenu(){
      orderMenuContainer.innerHTML="";
      if(menuItems.length===0){
        orderMenuContainer.innerHTML=`<p class="text-center text-gray-500 col-span-full">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>`;
        return;
      }
      menuItems.forEach(item=>{
        const card=document.createElement("div");
        card.className="bg-white rounded-xl shadow-md p-4 flex flex-col items-center hover:shadow-lg transition";
        const imageHtml = item.img 
          ? `<img src="${item.img}" alt="${item.name}" class="w-24 h-24 mb-3 object-cover rounded">` 
          : '<div class="w-24 h-24 mb-3 bg-gray-200 rounded flex items-center justify-center text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>';
        card.innerHTML=`
          ${imageHtml}
          <h2 class="font-semibold">${item.name}${item.size ? " ("+item.size+")" : ""}</h2>
          <p class="text-gray-600 mb-3">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addToOrder(${item.id})">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        `;
        orderMenuContainer.appendChild(card);
      });
    }

    function addToOrder(id){
      const item=menuItems.find(i=>i.id===id);
      const existing=order.find(o=>o.id===id);
      if(existing) existing.qty++; else order.push({...item,qty:1});
      updateOrderSummary();
    }

    function updateOrderSummary(){
      orderList.innerHTML="";
      let total=0;
      order.forEach(item=>{
        total+=item.price*item.qty;
        const sizeText=item.size ? ` (${item.size})` : "";
        orderList.innerHTML+=`<li class="flex justify-between items-center mb-1">${item.name}${sizeText} x${item.qty} <button onclick="removeItem(${item.id})" class="text-red-500 ml-2">‚úï</button></li>`;
      });
      totalDisplay.textContent=total;
      orderSummary.classList.toggle("hidden",order.length===0);
    }

    function removeItem(id){ order=order.filter(i=>i.id!==id); updateOrderSummary(); }

    function submitOrder(){
      if(order.length===0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£");
      
      // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const currentUser = getCurrentUser();
      
      const orderData = {
        id: Date.now(),
        timestamp: new Date().toLocaleString(),
        username: currentUser ? currentUser.username : 'admin',
        orderedBy: currentUser ? currentUser.username : 'admin',
        items: order,
        total: totalDisplay.textContent
      };
      
      pendingOrders.push(orderData);
      localStorage.setItem("pendingOrders", JSON.stringify(pendingOrders));
      
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á allOrders ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ
      allOrders.push(orderData);
      localStorage.setItem("allOrders", JSON.stringify(allOrders));
      
      alert("‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
      order = [];
      updateOrderSummary();
      showSection('report');
      updateReport();
    }

    // ---------- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö ----------
    function showMenuTab(tab) {
      const menuTab = document.getElementById('menuTab');
      const promoTab = document.getElementById('promoTab');
      const menuManagement = document.getElementById('menuManagement');
      const promoManagement = document.getElementById('promoManagement');
      
      if (tab === 'menu') {
        menuTab.className = 'px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold';
        menuTab.innerHTML = 'üçî ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π';
        promoTab.className = 'px-4 py-2 rounded-lg bg-gray-300 text-gray-900 font-semibold hover:bg-gray-400';
        promoTab.innerHTML = 'üî• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô';
        menuManagement.classList.remove('hidden');
        promoManagement.classList.add('hidden');
      } else {
        menuTab.className = 'px-4 py-2 rounded-lg bg-gray-300 text-gray-900 font-semibold hover:bg-gray-400';
        menuTab.innerHTML = 'üçî ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π';
        promoTab.className = 'px-4 py-2 rounded-lg bg-blue-500 text-white font-semibold';
        promoTab.innerHTML = 'üî• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô';
        menuManagement.classList.add('hidden');
        promoManagement.classList.remove('hidden');
        renderPromoTable();
      }
    }

    // ---------- ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô ----------
    // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏à‡∏≤‡∏Å localStorage ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    let promoItems = [
      {id:101,name:"‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡∏ä‡∏¥‡πâ‡∏ô", options:[
        {label:"3 ‡∏ä‡∏¥‡πâ‡∏ô = 39 ‡∏ö‡∏≤‡∏ó", price:39, qty:1},
        {label:"6 ‡∏ä‡∏¥‡πâ‡∏ô = 79 ‡∏ö‡∏≤‡∏ó", price:79, qty:1},
        {label:"10 ‡∏ä‡∏¥‡πâ‡∏ô = 129 ‡∏ö‡∏≤‡∏ó", price:129, qty:1},
      ]},
      {id:102,name:"‡πÇ‡∏õ‡∏£‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÉ‡∏´‡∏ç‡πà", options:[
        {label:"3 ‡∏ä‡∏¥‡πâ‡∏ô = 79 ‡∏ö‡∏≤‡∏ó", price:79, qty:1},
        {label:"6 ‡∏ä‡∏¥‡πâ‡∏ô = 159 ‡∏ö‡∏≤‡∏ó", price:159, qty:1},
      ]},
      {id:103,name:"‡πÇ‡∏õ‡∏£‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÑ‡∏Å‡πà", options:[
        {label:"3 ‡∏ä‡∏¥‡πâ‡∏ô = 99 ‡∏ö‡∏≤‡∏ó", price:99, qty:1},
      ]},
      {id:104,name:"‡πÇ‡∏õ‡∏£‡πÑ‡∏Å‡πà‡πÑ‡∏£‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å", options:[
        {label:"5 ‡∏ä‡∏¥‡πâ‡∏ô = 59 ‡∏ö‡∏≤‡∏ó", price:59, qty:1},
        {label:"10 ‡∏ä‡∏¥‡πâ‡∏ô = 99 ‡∏ö‡∏≤‡∏ó", price:99, qty:1},
      ]},
      {id:105,name:"‡πÇ‡∏õ‡∏£‡∏£‡∏ß‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©", options:[
        {label:"‡∏™‡∏∞‡πÇ‡∏û‡∏Å 1 + ‡∏ô‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà 2 = 89 ‡∏ö‡∏≤‡∏ó", price:89, qty:1},
         {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå M + ‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î (‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 15) 3 ‡∏ä‡∏¥‡πâ‡∏ô = 69 ‡∏ö‡∏≤‡∏ó", price:69, qty:1},
      ]},
      {id:106,name:"‡πÄ‡∏ã‡∏ï‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°", options:[
        {label:"‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 1  = 109 ‡∏ö‡∏≤‡∏ó", price:109, qty:1},
        {label:"‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 2  = 209 ‡∏ö‡∏≤‡∏ó", price:209, qty:1},
        {label:"‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞ 3  = 309 ‡∏ö‡∏≤‡∏ó", price:309, qty:1},
      ]},
      // --- ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå ---
      {id:201, name:"‡πÇ‡∏õ‡∏£‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå & ‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å", options:[
        {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå+‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å S = 29", price:29, qty:1, details:"S"},
        {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå+‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å M = 39", price:39, qty:1, details:"M"},
        {label:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ä‡πå‡∏ü‡∏£‡∏≤‡∏¢‡∏™‡πå+‡∏Æ‡∏≠‡∏ó‡∏î‡∏≠‡∏Å L = 49", price:49, qty:1, details:"L"},
      ]}
    ];
    const promoContainer=document.getElementById("promoContainer");

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏à‡∏≤‡∏Å localStorage
    function loadPromoData() {
      const savedPromos = localStorage.getItem("promoData");
      if (savedPromos) {
        promoItems = JSON.parse(savedPromos);
        console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏à‡∏≤‡∏Å localStorage (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + promoItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)');
      } else {
        // ‡πÉ‡∏ä‡πâ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        savePromos();
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
    function savePromos() {
      localStorage.setItem("promoData", JSON.stringify(promoItems));
      localStorage.setItem("promoDataTimestamp", Date.now().toString());
      console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏•‡∏á localStorage (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ' + promoItems.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)');
      
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
      const promoCountEl = document.getElementById('promoCount');
      if (promoCountEl) promoCountEl.textContent = promoItems.length;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    function renderPromos(){
      if (!promoContainer) return;
      promoContainer.innerHTML="";
      
      if (promoItems.length === 0) {
        promoContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</p>';
        return;
      }
      
      promoItems.forEach(promo=>{
        const card=document.createElement("div");
        card.className="bg-yellow-200 p-4 rounded-lg shadow flex flex-col gap-2";
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        let imageHtml = '';
        if (promo.image) {
          imageHtml = `<img src="${promo.image}" alt="${promo.name}" class="w-full h-32 object-cover rounded-lg mb-2">`;
        }
        
        card.innerHTML=`${imageHtml}<h3 class="font-semibold text-lg">${promo.name}</h3>`;
        promo.options.forEach(opt=>{
          const btn=document.createElement("button");
          btn.className="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600";
          btn.textContent=opt.label;
          btn.onclick=()=> addPromoToOrder(promo.name,opt.price,opt.qty,opt.details);
          card.appendChild(btn);
        });
        promoContainer.appendChild(card);
      });
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
    function renderPromoTable() {
      const promoTable = document.getElementById('promoTable');
      if (!promoTable) return;
      
      promoTable.innerHTML = "";
      
      if (promoItems.length === 0) {
        promoTable.innerHTML = '<tr><td colspan="4" class="border p-4 text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</td></tr>';
        return;
      }
      
      promoItems.forEach((promo, index) => {
        const optionsText = promo.options.map(opt => opt.label).join('<br>');
        const imageHtml = promo.image 
          ? `<img src="${promo.image}" alt="${promo.name}" class="w-16 h-16 mx-auto object-cover rounded">` 
          : '<div class="w-16 h-16 mx-auto bg-gray-200 rounded flex items-center justify-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</div>';
        promoTable.innerHTML += `
          <tr class="text-center hover:bg-gray-50">
            <td class="border p-2">${imageHtml}</td>
            <td class="border p-3 font-semibold">${promo.name}</td>
            <td class="border p-3 text-sm">${optionsText}</td>
            <td class="border p-3">
              <button onclick="editPromo(${index})" class="bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 mr-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deletePromo(${index})" class="bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600">‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      });
      
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
      const promoCountEl = document.getElementById('promoCount');
      if (promoCountEl) promoCountEl.textContent = promoItems.length;
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
    function deletePromo(index) {
      if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô "' + promoItems[index].name + '" ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) {
        promoItems.splice(index, 1);
        savePromos();
        renderPromoTable();
        renderPromos();
        alert('‚úÖ ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
    let editingPromoIndex = -1;
    let editPromoOptionsList = [];
    
    function editPromo(index) {
      editingPromoIndex = index;
      const promo = promoItems[index];
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      document.getElementById('editPromoForm').classList.remove('hidden');
      document.getElementById('editPromoName').value = promo.name;
      
      // ‡πÅ‡∏™‡∏î‡∏á preview ‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const preview = document.getElementById('editPromoPreviewImage');
      if(promo.image) {
        preview.src = promo.image;
        preview.classList.remove('hidden');
      } else {
        preview.classList.add('hidden');
      }
      
      // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      editPromoOptionsList = JSON.parse(JSON.stringify(promo.options)); // Deep copy
      renderEditPromoOptions();
      
      // Reset radio buttons
      document.querySelector('input[name="editPromoImageSource"][value="none"]').checked = true;
      document.getElementById('editPromoImageUrl').classList.add('hidden');
      document.getElementById('editPromoImageFile').classList.add('hidden');
      
      // Scroll to form
      document.getElementById('editPromoForm').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function renderEditPromoOptions() {
      const container = document.getElementById('editPromoOptionsContainer');
      
      if(editPromoOptionsList.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>';
        return;
      }
      
      container.innerHTML = '';
      
      editPromoOptionsList.forEach((opt, idx) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'rounded-xl p-3 mb-2';
        optionDiv.style.backgroundColor = '#FFE7A0';
        optionDiv.style.border = '1px solid #E5E4E2';
        
        optionDiv.innerHTML = `
          <div class="flex justify-between items-center mb-2">
            <span class="font-semibold" style="color: #D8504C;">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${idx + 1}</span>
            <button type="button" onclick="removeEditPromoOption(${idx})" class="text-red-600 hover:text-red-800 font-bold">
              üóëÔ∏è ‡∏•‡∏ö
            </button>
          </div>
          <div class="space-y-2">
            <input type="text" value="${opt.label.split(' = ')[0]}" id="editOptName${idx}" placeholder="‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô: 3 ‡∏ä‡∏¥‡πâ‡∏ô)" class="w-full px-3 py-2 rounded-lg text-sm" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
            <div class="grid grid-cols-2 gap-2">
              <input type="number" value="${opt.price}" id="editOptPrice${idx}" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="px-3 py-2 rounded-lg text-sm" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
              <input type="number" value="${opt.qty || 1}" id="editOptQty${idx}" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="px-3 py-2 rounded-lg text-sm" style="border: 1px solid #E5E4E2; background-color: #FAF9F7;">
            </div>
          </div>
        `;
        container.appendChild(optionDiv);
      });
    }
    
    function addEditPromoOption() {
      editPromoOptionsList.push({ label: '', price: 0, qty: 1 });
      renderEditPromoOptions();
    }
    
    function removeEditPromoOption(idx) {
      editPromoOptionsList.splice(idx, 1);
      renderEditPromoOptions();
    }
    
    function cancelEditPromo() {
      editingPromoIndex = -1;
      editPromoOptionsList = [];
      document.getElementById('editPromoForm').classList.add('hidden');
      document.getElementById('editPromoImageUrl').value = '';
      document.getElementById('editPromoImageFile').value = '';
      document.getElementById('editPromoPreviewImage').classList.add('hidden');
    }
    
    function saveEditPromo() {
      if(editingPromoIndex === -1) return;
      
      const promo = promoItems[editingPromoIndex];
      const newName = document.getElementById('editPromoName').value.trim();
      
      if(!newName) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô');
        return;
      }
      
      // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      const options = [];
      for(let i = 0; i < editPromoOptionsList.length; i++) {
        const nameEl = document.getElementById('editOptName' + i);
        const priceEl = document.getElementById('editOptPrice' + i);
        const qtyEl = document.getElementById('editOptQty' + i);
        
        if(nameEl && priceEl && qtyEl) {
          const name = nameEl.value.trim();
          const price = parseFloat(priceEl.value);
          const qty = parseInt(qtyEl.value) || 1;
          
          if(name && price) {
            options.push({
              label: name + ' = ' + price + ' ‡∏ö‡∏≤‡∏ó',
              price: price,
              qty: qty
            });
          }
        }
      }
      
      if(options.length === 0) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
        return;
      }
      
      promo.name = newName;
      promo.options = options;
      
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      const imageSource = document.querySelector('input[name="editPromoImageSource"]:checked').value;
      
      if(imageSource === 'url') {
        const url = document.getElementById('editPromoImageUrl').value.trim();
        if(url) promo.image = url;
      } else if(imageSource === 'file') {
        const file = document.getElementById('editPromoImageFile').files[0];
        if(file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            promo.image = e.target.result;
            finishEditPromo();
          };
          reader.readAsDataURL(file);
          return;
        }
      } else if(imageSource === 'remove') {
        promo.image = '';
      }
      
      finishEditPromo();
    }
    
    function finishEditPromo() {
      savePromos();
      renderPromoTable();
      renderPromos();
      cancelEditPromo();
      alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }
    
    // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
    document.querySelectorAll('input[name="editPromoImageSource"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const urlInput = document.getElementById('editPromoImageUrl');
        const fileInput = document.getElementById('editPromoImageFile');
        
        if(this.value === 'url') {
          urlInput.classList.remove('hidden');
          fileInput.classList.add('hidden');
        } else if(this.value === 'file') {
          urlInput.classList.add('hidden');
          fileInput.classList.remove('hidden');
        } else {
          urlInput.classList.add('hidden');
          fileInput.classList.add('hidden');
        }
      });
    });
    
    // Preview ‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å URL
    document.getElementById('editPromoImageUrl').addEventListener('input', function() {
      const preview = document.getElementById('editPromoPreviewImage');
      if(this.value.trim()) {
        preview.src = this.value.trim();
        preview.classList.remove('hidden');
      }
    });
    
    // Preview ‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå
    document.getElementById('editPromoImageFile').addEventListener('change', function() {
      const file = this.files[0];
      const preview = document.getElementById('editPromoPreviewImage');
      if(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });
    
    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    let tempPromoOptions = [];
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
    function addPromoOption() {
      const container = document.getElementById('promoOptionsContainer');
      const index = tempPromoOptions.length;
      
      const optionDiv = document.createElement('div');
      optionDiv.className = 'flex gap-2 items-center bg-gray-50 p-3 rounded-lg';
      optionDiv.id = 'promoOption' + index;
      optionDiv.innerHTML = `
        <input type="text" id="optionName${index}" placeholder="‡πÄ‡∏ä‡πà‡∏ô: 3 ‡∏ä‡∏¥‡πâ‡∏ô" class="flex-1 border p-2 rounded" required>
        <input type="number" id="optionPrice${index}" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" class="w-24 border p-2 rounded" required>
        <input type="number" id="optionQty${index}" value="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="w-20 border p-2 rounded" required>
        <button type="button" onclick="removePromoOption(${index})" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">
          üóëÔ∏è
        </button>
      `;
      
      container.appendChild(optionDiv);
      tempPromoOptions.push({ index: index });
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function removePromoOption(index) {
      const optionDiv = document.getElementById('promoOption' + index);
      if (optionDiv) {
        optionDiv.remove();
        tempPromoOptions = tempPromoOptions.filter(opt => opt.index !== index);
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
    function saveNewPromo() {
      const groupName = document.getElementById('promoGroupName').value.trim();
      
      if (!groupName) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô');
        return;
      }
      
      if (tempPromoOptions.length === 0) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
        return;
      }
      
      // ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      const options = [];
      for (const opt of tempPromoOptions) {
        const nameEl = document.getElementById('optionName' + opt.index);
        const priceEl = document.getElementById('optionPrice' + opt.index);
        const qtyEl = document.getElementById('optionQty' + opt.index);
        
        if (nameEl && priceEl && qtyEl) {
          const name = nameEl.value.trim();
          const price = parseFloat(priceEl.value);
          const qty = parseInt(qtyEl.value) || 1;
          
          if (name && price) {
            options.push({
              label: name + ' = ' + price + ' ‡∏ö‡∏≤‡∏ó',
              price: price,
              qty: qty
            });
          }
        }
      }
      
      if (options.length === 0) {
        alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
        return;
      }
      
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      let promoImage = '';
      const imageSource = document.querySelector('input[name="promoImageSource"]:checked').value;
      
      if (imageSource === 'url') {
        promoImage = document.getElementById('promoImageUrlInput').value.trim();
      } else if (imageSource === 'file') {
        promoImage = window._lastPromoImageDataUrl || '';
      }
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
      const newPromo = {
        id: Date.now(),
        name: groupName,
        options: options,
        image: promoImage
      };
      
      promoItems.push(newPromo);
      savePromos();
      renderPromoTable();
      renderPromos();
      clearPromoForm();
      
      alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (' + options.length + ' ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)');
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    function clearPromoForm() {
      document.getElementById('promoGroupName').value = '';
      document.getElementById('promoOptionsContainer').innerHTML = '';
      tempPromoOptions = [];
      
      // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      document.getElementById('promoImageNone').checked = true;
      document.getElementById('promoImageUrlInput').value = '';
      document.getElementById('promoImageUrlInput').classList.add('hidden');
      document.getElementById('promoImageFileInput').value = '';
      document.getElementById('promoImageFileInput').classList.add('hidden');
      document.getElementById('promoPreviewImage').src = '';
      document.getElementById('promoPreviewImage').classList.add('hidden');
      window._lastPromoImageDataUrl = null;
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏£‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      addPromoOption();
    }
    
    // Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
    document.getElementById('promoImageNone').addEventListener('change', function() {
      if (this.checked) {
        document.getElementById('promoImageUrlInput').classList.add('hidden');
        document.getElementById('promoImageFileInput').classList.add('hidden');
        document.getElementById('promoPreviewImage').classList.add('hidden');
      }
    });
    
    document.getElementById('promoImageUrl').addEventListener('change', function() {
      if (this.checked) {
        document.getElementById('promoImageUrlInput').classList.remove('hidden');
        document.getElementById('promoImageFileInput').classList.add('hidden');
      }
    });
    
    document.getElementById('promoImageFile').addEventListener('change', function() {
      if (this.checked) {
        document.getElementById('promoImageUrlInput').classList.add('hidden');
        document.getElementById('promoImageFileInput').classList.remove('hidden');
      }
    });
    
    // Preview ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å URL
    document.getElementById('promoImageUrlInput').addEventListener('input', function() {
      const val = this.value.trim();
      const preview = document.getElementById('promoPreviewImage');
      if (val) {
        preview.src = val;
        preview.classList.remove('hidden');
      } else {
        preview.src = '';
        preview.classList.add('hidden');
      }
    });
    
    // Preview ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå
    document.getElementById('promoImageFileInput').addEventListener('change', function() {
      const file = this.files && this.files[0];
      const preview = document.getElementById('promoPreviewImage');
      if (!file) {
        preview.src = '';
        preview.classList.add('hidden');
        window._lastPromoImageDataUrl = null;
        return;
      }
      const reader = new FileReader();
      reader.onload = function(ev) {
        const dataUrl = ev.target.result;
        window._lastPromoImageDataUrl = dataUrl;
        preview.src = dataUrl;
        preview.classList.remove('hidden');
      };
      reader.readAsDataURL(file);
    });
    
    // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢
    document.getElementById('promoPreviewImage').addEventListener('click', function() {
      if (this.src) window.open(this.src, '_blank');
    });
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    window.addEventListener('load', function() {
      if (document.getElementById('promoOptionsContainer')) {
        addPromoOption();
      }
    });
    
    // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    loadPromoData();

    function addPromoToOrder(name,price,qty,size){
      const existing=order.find(o=>o.name===name && o.price===price && o.size===size);
      if(existing) existing.qty+=qty;
      else order.push({id:Date.now(),name,price,qty,size});
      updateOrderSummary();
    }

    renderOrderMenu(); renderPromos();

    // ---------- ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ----------
    function updateReport(){
      const reportSection=document.getElementById("reportSection");
      reportSection.innerHTML=`<h2 class="text-2xl font-semibold mb-4">üí∞ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>`;

      if(pendingOrders.length===0){ reportSection.innerHTML+=`<div class="bg-white p-4 rounded shadow">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>`; 
      return; 
     }

      let totalIncome=0;
      const container=document.createElement("div");
      container.className="bg-white p-4 rounded shadow space-y-4";
      const menuSummary={};
      pendingOrders.forEach((ord,index)=>{
        let orderHtml=`<div class="border-b pb-2"><p class="font-semibold">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index+1} - ${ord.timestamp}</p><ul class="ml-4">`;
        ord.items.forEach(item=>{
          const sizeText=item.size?` (${item.size})`:"";
          orderHtml+=`<li>${item.name}${sizeText} x${item.qty} = ${item.price*item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
          totalIncome+=item.price*item.qty;
          const key=item.name+(item.size?` (${item.size})`:"");
          if(menuSummary[key]) menuSummary[key].qty+=item.qty;
          else menuSummary[key]={price:item.price,qty:item.qty};
        });
        orderHtml+=`</ul>
        <p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${ord.total} ‡∏ö‡∏≤‡∏ó</p>
        <button onclick="confirmOrder(${index})" class="mt-2 bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ</button>
        </div>`;
        container.innerHTML+=orderHtml;
      });
      let summaryHtml=`<div class="bg-gray-100 p-3 rounded shadow mt-4"><p class="font-semibold mb-2">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏ô‡∏π</p><ul>`;
      for(const name in menuSummary){
        const item=menuSummary[name];
        summaryHtml+=`<li>${name}: ${item.qty} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏£‡∏ß‡∏° ${item.price*item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
      }
      summaryHtml+=`</ul></div>`;
      container.innerHTML+=summaryHtml;
      reportSection.appendChild(container);
      reportSection.innerHTML+=`<p class="mt-4 font-bold text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalIncome} ‡∏ö‡∏≤‡∏ó</p>`;
    }
    // ---------- Pending on Sheet (shared) ----------
    let fetchedPending = [];
    async function loadPendingFromSheet(){
      if(!WEB_APP_URL || WEB_APP_URL.includes('REPLACE_WITH_YOUR_WEB_APP_URL')) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà WEB_APP_URL ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå admin.html');
      try{
        const res = await fetch(WEB_APP_URL + '?action=getPending');
        if(!res.ok) throw new Error('HTTP '+res.status);
        const j = await res.json();
        if(j && j.status === 'success'){
          fetchedPending = j.pending || [];
          renderFetchedPending();
          alert('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ pending ‡∏à‡∏≤‡∏Å Google Sheet ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        } else {
          console.warn('loadPendingFromSheet', j);
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î pending ‡πÑ‡∏î‡πâ');
        }
      }catch(err){ console.error(err); alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Web App ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
    }

    function renderFetchedPending(){
      const reportSection=document.getElementById("reportSection");
      const container = document.createElement('div');
      container.className='bg-white p-4 rounded shadow space-y-4 mt-4';
      if(!fetchedPending || fetchedPending.length===0){ container.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ pending ‡πÉ‡∏ô sheet</p>'; reportSection.appendChild(container); return; }
      fetchedPending.forEach((p, idx)=>{
        let html = `<div class="border-b pb-2"><p class="font-semibold">#${p.PendingID} - ${p.Timestamp}</p><ul class="ml-4">`;
        const items = JSON.parse(p.Items_JSON || '[]');
        items.forEach(it=>{ html+=`<li>${it.name}${it.size?(' ('+it.size+')'):''} x${it.qty} = ${it.price*it.qty} ‡∏ö‡∏≤‡∏ó</li>`; });
        html+=`</ul><p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${p.Total} ‡∏ö‡∏≤‡∏ó</p><div class="mt-2"><button onclick="confirmPendingOnSheet('${p.PendingID}','${idx}')" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Sheets</button></div></div>`;
        container.innerHTML += html;
      });
      reportSection.appendChild(container);
    }

    async function confirmPendingOnSheet(pendingId, idx){
      if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏•‡∏á Google Sheets ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      try{
        const res = await fetch(WEB_APP_URL, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ action: 'confirmPending', pendingId: pendingId }) });
        const j = await res.json().catch(()=>null);
        if(res.ok && j && j.status === 'success'){
          alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
          // remove from fetchedPending and re-render
          fetchedPending = fetchedPending.filter(p => String(p.PendingID) !== String(pendingId));
          renderFetchedPending();
          // also refresh local history
          renderHistory();
        } else {
          console.warn('confirmPendingOnSheet', res.status, j);
          alert('‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‚Äî ‡∏î‡∏π console');
        }
      }catch(err){ console.error(err); alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Web App ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
    }
    function renderHistory(){
      const historyContainer = document.getElementById("historyContainer");
      historyContainer.innerHTML = "";
      if(allOrders.length === 0){
        historyContainer.innerHTML = `<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>`;
        return;
      }

      allOrders.forEach((order, index) => {
        let itemsHtml = "";
        order.items.forEach(item => {
          const sizeText = item.size ? ` (${item.size})` : "";
          itemsHtml += `<li>${item.name}${sizeText} x${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
        });
        historyContainer.innerHTML += `
          <div class="border-b pb-2">
            <p class="font-semibold">üßæ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index + 1} - ${order.timestamp}</p>
            <ul class="ml-4 list-disc">${itemsHtml}</ul>
            <p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${order.total} ‡∏ö‡∏≤‡∏ó</p>
          </div>
        `;
      });
    }
    function clearAllHistory() {
      if (!confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;

      localStorage.removeItem("allOrders");
      localStorage.removeItem("completedOrders");

      allOrders = [];
      completedOrders = [];
      renderHistory()
      alert("‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }

    function confirmOrder(index) {
      const confirmed = confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
      if (!confirmed) return;
      // ‡∏¢‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å pendingOrders ‚Üí completedOrders
      completedOrders.push(pendingOrders[index]);
      pendingOrders.splice(index, 1);
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏á localStorage
      localStorage.setItem("pendingOrders", JSON.stringify(pendingOrders));
      localStorage.setItem("completedOrders", JSON.stringify(completedOrders));
       // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤
      updateReport();
      renderHistory();
    }

    // ---------- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ----------
    function initializeUserManagement() {
      const usersList = document.getElementById('usersList');
      const addUserForm = document.getElementById('addUserForm');

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á Staff
      function getUserOrderHistory(username) {
        const allOrders = JSON.parse(localStorage.getItem('allOrders') || '[]');
        const completedOrders = JSON.parse(localStorage.getItem('completedOrders') || '[]');
        const pendingOrders = JSON.parse(localStorage.getItem('pendingOrders') || '[]');
        
        // ‡∏£‡∏ß‡∏°‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        const allUserOrders = [...allOrders, ...completedOrders, ...pendingOrders];
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á user ‡∏ô‡∏µ‡πâ
        const userOrders = allUserOrders.filter(order => 
          order.username === username || order.orderedBy === username
        );
        
        return userOrders;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
      function calculateUserStats(username) {
        const orders = getUserOrderHistory(username);
        const totalOrders = orders.length;
        const totalAmount = orders.reduce((sum, order) => {
          const orderTotal = typeof order.total === 'string' 
            ? parseFloat(order.total) 
            : order.total || 0;
          return sum + orderTotal;
        }, 0);
        
        return { totalOrders, totalAmount };
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ user ‡∏Å‡∏≥‡∏•‡∏±‡∏á login ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ + Google Sheets)
      function isUserOnline(username) {
        const now = Date.now();
        const ONLINE_THRESHOLD = 120000; // 2 ‡∏ô‡∏≤‡∏ó‡∏µ (120,000 ‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
        
        // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å sessionStorage ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πá‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Admin ‡πÄ‡∏≠‡∏á)
        try {
          const currentUser = sessionStorage.getItem('restaurant_current_user');
          if (currentUser) {
            const user = JSON.parse(currentUser);
            if (user.username === username) {
              console.log(`‚úÖ ${username} is online (current tab)`);
              return true;
            }
          }
        } catch (e) {
          console.error('Error checking sessionStorage:', e);
        }
        
        // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å online_users list (‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
        try {
          const onlineUsers = JSON.parse(localStorage.getItem('online_users') || '[]');
          const userOnline = onlineUsers.find(u => u.username === username);
          
          if (userOnline) {
            const timeSinceActive = now - userOnline.lastActive;
            if (timeSinceActive < ONLINE_THRESHOLD) {
              console.log(`‚úÖ ${username} is online (online_users: ${Math.floor(timeSinceActive/1000)}s ago)`);
              return true;
            }
          }
        } catch (e) {
          console.error('Error checking online_users:', e);
        }
        
        // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å last_login (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î)
        try {
          const lastLoginTime = localStorage.getItem(`last_login_${username}`);
          if (lastLoginTime) {
            const timeSinceLogin = now - parseInt(lastLoginTime);
            if (timeSinceLogin < ONLINE_THRESHOLD) {
              console.log(`‚úÖ ${username} is online (last_login: ${Math.floor(timeSinceLogin/1000)}s ago)`);
              return true;
            }
          }
        } catch (e) {
          console.error('Error checking last_login:', e);
        }
        
        // 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Google Sheets (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô)
        try {
          const sheetsOnlineUsers = window.sheetsOnlineUsers || [];
          const userInSheets = sheetsOnlineUsers.find(u => u.username === username);
          
          if (userInSheets && userInSheets.isOnline) {
            console.log(`‚úÖ ${username} is online (Google Sheets)`);
            return true;
          }
        } catch (e) {
          console.error('Error checking Sheets:', e);
        }
        
        console.log(`‚ö™ ${username} is offline`);
        return false;
      }
      
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• online users ‡∏à‡∏≤‡∏Å Google Sheets
      async function fetchOnlineUsersFromSheets() {
        if (!WEB_APP_URL || WEB_APP_URL.includes('REPLACE_WITH_YOUR_WEB_APP_URL')) {
          console.log('‚ö†Ô∏è WEB_APP_URL not configured');
          return;
        }
        
        try {
          const response = await fetch(WEB_APP_URL + '?action=getOnlineUsers');
          if (response.ok) {
            const data = await response.json();
            if (data.status === 'success') {
              window.sheetsOnlineUsers = data.users || [];
              console.log(`‚úÖ Fetched ${window.sheetsOnlineUsers.length} online users from Sheets`);
            }
          }
        } catch (error) {
          console.log('Could not fetch from Sheets (optional):', error.message);
        }
      }
      
      // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô global function
      window.fetchOnlineUsersFromSheets = fetchOnlineUsersFromSheets;
      
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      function getLastLoginTime(username) {
        const lastLoginTime = localStorage.getItem(`last_login_${username}`);
        if (lastLoginTime) {
          const date = new Date(parseInt(lastLoginTime));
          return date.toLocaleString('th-TH');
        }
        return '‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢ login';
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      function updateUserStats() {
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        const adminCount = users.filter(u => u.role === 'admin').length;
        const staffCount = users.filter(u => u.role === 'staff').length;
        
        document.getElementById('totalUsers').textContent = users.length;
        document.getElementById('adminCount').textContent = adminCount;
        document.getElementById('staffCount').textContent = staffCount;
      }
      
      // Debug Panel ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß - ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ
      window.toggleDebugPanel = function() {
        console.log('Debug Panel has been removed');
      };
      
      // Debug Panel ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß - ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ
      function updateDebugPanel() {
        return; // ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
        const display = document.getElementById('debugStatusDisplay');
        if (!display) return;
        
        const now = Date.now();
        const ONLINE_THRESHOLD = 120000; // 2 ‡∏ô‡∏≤‡∏ó‡∏µ
        let html = '';

        // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö sessionStorage
        const currentUser = sessionStorage.getItem('restaurant_current_user');
        html += `
          <div class="bg-gray-800 rounded-lg p-4 border-2 border-blue-500">
            <h4 class="font-bold mb-2 text-blue-300">1Ô∏è‚É£ sessionStorage (‡πÅ‡∏ó‡πá‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</h4>
            <pre class="text-sm bg-gray-950 p-3 rounded overflow-auto">${currentUser || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</pre>
          </div>
        `;

        // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö online_users
        const onlineUsers = localStorage.getItem('online_users');
        let onlineUsersData = [];
        try {
          onlineUsersData = JSON.parse(onlineUsers || '[]');
        } catch(e) {}
        
        let onlineUsersHtml = '<div class="space-y-2">';
        if (onlineUsersData.length === 0) {
          onlineUsersHtml += '<p class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ online</p>';
        } else {
          onlineUsersData.forEach(u => {
            const timeSinceActive = now - u.lastActive;
            const isOnline = timeSinceActive < ONLINE_THRESHOLD;
            const seconds = Math.floor(timeSinceActive / 1000);
            onlineUsersHtml += `
              <div class="bg-gray-950 p-3 rounded flex items-center justify-between">
                <span class="font-medium">${u.username} <span class="text-gray-400 text-xs">(${u.role})</span></span>
                <div class="flex items-center gap-2">
                  <span class="text-xs text-gray-400">${seconds}s ago</span>
                  <span class="px-2 py-1 rounded text-xs ${isOnline ? 'bg-green-600 text-white' : 'bg-gray-600 text-gray-300'}">
                    ${isOnline ? 'üü¢ Online' : '‚ö™ Offline'}
                  </span>
                </div>
              </div>
            `;
          });
        }
        onlineUsersHtml += '</div>';
        
        html += `
          <div class="bg-gray-800 rounded-lg p-4 border-2 border-green-500">
            <h4 class="font-bold mb-2 text-green-300">2Ô∏è‚É£ online_users (localStorage)</h4>
            ${onlineUsersHtml}
          </div>
        `;

        // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö last_login
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        let lastLoginHtml = '<div class="space-y-2">';
        users.forEach(user => {
          const username = user.username;
          const lastLogin = localStorage.getItem(`last_login_${username}`);
          if (lastLogin) {
            const date = new Date(parseInt(lastLogin));
            const timeDiff = now - parseInt(lastLogin);
            const seconds = Math.floor(timeDiff / 1000);
            const minutes = Math.floor(timeDiff / 60000);
            const isOnline = timeDiff < ONLINE_THRESHOLD;
            
            lastLoginHtml += `
              <div class="bg-gray-950 p-3 rounded flex items-center justify-between">
                <div>
                  <span class="font-medium">${username}</span>
                  <span class="text-xs text-gray-400 ml-2">${date.toLocaleString('th-TH')}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-xs text-gray-400">${seconds}s (${minutes}m)</span>
                  <span class="px-2 py-1 rounded text-xs ${isOnline ? 'bg-green-600 text-white' : 'bg-gray-600 text-gray-300'}">
                    ${isOnline ? 'üü¢ Online' : '‚ö™ Offline'}
                  </span>
                </div>
              </div>
            `;
          } else {
            lastLoginHtml += `
              <div class="bg-gray-950 p-3 rounded flex items-center justify-between">
                <span class="font-medium">${username}</span>
                <span class="text-xs text-gray-400">‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢ login</span>
              </div>
            `;
          }
        });
        lastLoginHtml += '</div>';

        html += `
          <div class="bg-gray-800 rounded-lg p-4 border-2 border-yellow-500">
            <h4 class="font-bold mb-2 text-yellow-300">3Ô∏è‚É£ last_login_* (localStorage)</h4>
            ${lastLoginHtml}
          </div>
        `;
        
        // 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Sheets
        const sheetsOnlineUsers = window.sheetsOnlineUsers || [];
        let sheetsHtml = '<div class="space-y-2">';
        if (sheetsOnlineUsers.length === 0) {
          sheetsHtml += '<p class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets (‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤)</p>';
        } else {
          sheetsOnlineUsers.forEach(u => {
            const timeSinceActive = now - u.lastActive;
            const seconds = Math.floor(timeSinceActive / 1000);
            const minutes = Math.floor(timeSinceActive / 60000);
            const isOnline = u.isOnline;
            
            sheetsHtml += `
              <div class="bg-gray-950 p-3 rounded flex items-center justify-between">
                <div>
                  <span class="font-medium">${u.username}</span>
                  <span class="text-xs text-gray-400 ml-2">(${u.role})</span>
                  <span class="text-xs text-gray-500 ml-2">Browser: ${u.browser.substring(0, 15)}...</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-xs text-gray-400">${seconds}s (${minutes}m)</span>
                  <span class="px-2 py-1 rounded text-xs ${isOnline ? 'bg-green-600 text-white' : 'bg-gray-600 text-gray-300'}">
                    ${isOnline ? 'üü¢ Online' : '‚ö™ Offline'}
                  </span>
                </div>
              </div>
            `;
          });
        }
        sheetsHtml += '</div>';
        
        html += `
          <div class="bg-gray-800 rounded-lg p-4 border-2 border-purple-500">
            <h4 class="font-bold mb-2 text-purple-300">4Ô∏è‚É£ Google Sheets (‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå)</h4>
            <p class="text-xs text-gray-400 mb-2">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
            ${sheetsHtml}
          </div>
        `;

        display.innerHTML = html;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      function loadUsers() {
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        updateUserStats();
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        usersList.innerHTML = users.map(user => {
          const stats = calculateUserStats(user.username);
          const isOnline = isUserOnline(user.username);
          
          return `
          <div class="bg-gray-50 p-4 rounded-lg flex flex-col border-2 ${isOnline ? 'border-green-300' : 'border-gray-200'}">
            <div class="flex justify-between items-center mb-3">
              <div class="flex-1">
                <h4 class="font-medium text-lg">${user.role === 'admin' ? 'üëë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : 'üë§ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'} (${user.username})</h4>
                <p class="text-sm text-gray-500 mt-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: ${user.password}</p>
                <div class="mt-2 flex gap-2 flex-wrap">
                  <span class="px-3 py-1 ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'} rounded-full text-sm font-medium">
                    ${user.role === 'admin' ? 'Admin' : 'Staff'}
                  </span>
                  ${stats.totalOrders > 0 ? `
                    <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium">
                      üì¶ ${stats.totalOrders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
                    </span>
                    <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                      üí∞ ${stats.totalAmount.toFixed(0)} ‡∏ö‡∏≤‡∏ó
                    </span>
                  ` : ''}
                </div>
              </div>
              <div class="text-right">
                <span class="px-3 py-1 ${isOnline ? 'bg-green-100 text-green-800 animate-pulse' : 'bg-gray-100 text-gray-500'} rounded-full text-sm font-medium block mb-2">
                  ${isOnline ? 'üü¢ Online' : '‚ö™ Offline'}
                </span>
                <p class="text-xs text-gray-500">Login ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</p>
                <p class="text-xs text-gray-600 font-medium">${getLastLoginTime(user.username)}</p>
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              <button onclick="viewUserHistory('${user.username}')" class="bg-indigo-500 text-white px-3 py-1 rounded text-sm hover:bg-indigo-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
              </button>
              <button onclick="testLogin('${user.username}', '${user.password}', '${user.role}')" 
                      class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
              </button>
              <button onclick="editUserPassword('${user.username}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
              </button>
              <button onclick="changeUserRole('${user.username}', '${user.role}')" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                </svg>
                ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
              </button>
              <button onclick="deleteUser('${user.username}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                ‡∏•‡∏ö
              </button>
            </div>
          </div>
        `;
        }).join('');
      }
      
      // ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Real-time
      let autoRefreshInterval = null;
      let sheetsRefreshInterval = null;
      
      function startRealTimeUpdates() {
        // ‡∏´‡∏¢‡∏∏‡∏î interval ‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }
        if (sheetsRefreshInterval) {
          clearInterval(sheetsRefreshInterval);
        }
        
        console.log('üöÄ Starting real-time updates...');
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        fetchOnlineUsersFromSheets().then(() => loadUsers());
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 2 ‡πÄ‡∏õ‡πá‡∏ô 3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î load)
        autoRefreshInterval = setInterval(() => {
          // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ users ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
          const usersSection = document.getElementById('usersSection');
          if (usersSection && !usersSection.classList.contains('hidden')) {
            console.log('üîÑ Auto-refreshing user list...');
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ loadUsers
            fetchOnlineUsersFromSheets().then(() => loadUsers());
          } else {
            console.log('‚è∏Ô∏è Users section hidden, skipping refresh');
          }
        }, 3000);
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô API call) - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ users
        sheetsRefreshInterval = setInterval(() => {
          console.log('üîÑ Background: Fetching from Sheets...');
          fetchOnlineUsersFromSheets();
        }, 10000);
      }
      
      function stopRealTimeUpdates() {
        if (autoRefreshInterval) {
          console.log('‚èπÔ∏è Stopping real-time updates');
          clearInterval(autoRefreshInterval);
          autoRefreshInterval = null;
        }
        if (sheetsRefreshInterval) {
          clearInterval(sheetsRefreshInterval);
          sheetsRefreshInterval = null;
        }
      }
      
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô global ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ showSection ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
      window.startRealTimeUpdates = startRealTimeUpdates;
      window.stopRealTimeUpdates = stopRealTimeUpdates;
      window.loadUsers = loadUsers;

      // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      addUserForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('newUsername').value.trim();
        const password = document.getElementById('newPassword').value.trim();
        const roleInputs = document.getElementsByName('newRole');
        let role = '';
        
        for (const input of roleInputs) {
          if (input.checked) {
            role = input.value;
            break;
          }
        }

        if (!username || !password || !role) {
          alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
          return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
        if (username.length < 3) {
          alert('‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
          return;
        }

        if (password.length < 3) {
          alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
          return;
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (users.some(u => u.username === username)) {
          alert('‚ùå ‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
          return;
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
        users.push({ username, password, role });
        localStorage.setItem('restaurant_users', JSON.stringify(users));
        
        const roleText = role === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
        alert(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ "${username}" (${roleText}) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
        this.reset();
        loadUsers();
      });

      // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      loadUsers();

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
      window.editUserPassword = function(username) {
        const newPassword = prompt('‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà:');
        if (!newPassword) return;

        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        const userIndex = users.findIndex(u => u.username === username);
        
        if (userIndex !== -1) {
          users[userIndex].password = newPassword;
          localStorage.setItem('restaurant_users', JSON.stringify(users));
          alert('‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          loadUsers(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        }
      };

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏≠‡∏á Staff
      window.viewUserHistory = function(username) {
        const orders = getUserOrderHistory(username);
        const stats = calculateUserStats(username);
        
        if (orders.length === 0) {
          alert(`‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ "${username}" ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£`);
          return;
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Modal ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
        modal.onclick = function(e) {
          if (e.target === modal) modal.remove();
        };
        
        let ordersHTML = orders.map((order, index) => {
          let itemsHTML = '';
          if (order.items && Array.isArray(order.items)) {
            itemsHTML = order.items.map(item => {
              const sizeText = item.size ? ` (${item.size})` : '';
              return `<li class="text-gray-700">${item.name}${sizeText} x${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
            }).join('');
          }
          
          return `
            <div class="bg-gray-50 p-4 rounded-lg mb-3">
              <div class="flex justify-between items-start mb-2">
                <p class="font-semibold text-gray-800">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index + 1}</p>
                <span class="text-sm text-gray-500">${order.timestamp || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤'}</span>
              </div>
              <ul class="ml-4 list-disc mb-2">${itemsHTML}</ul>
              <p class="font-bold text-green-600">‡∏£‡∏ß‡∏°: ${order.total} ‡∏ö‡∏≤‡∏ó</p>
            </div>
          `;
        }).join('');
        
        modal.innerHTML = `
          <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6">
              <div class="flex justify-between items-center">
                <div>
                  <h2 class="text-2xl font-bold mb-2">üìä ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
                  <p class="text-lg">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <strong>${username}</strong></p>
                </div>
                <button onclick="this.closest('.fixed').remove()" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
            </div>
            
            <div class="p-6 bg-gray-100">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="bg-white p-4 rounded-lg shadow">
                  <p class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                  <p class="text-3xl font-bold text-indigo-600">${stats.totalOrders}</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                  <p class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                  <p class="text-3xl font-bold text-green-600">${stats.totalAmount.toFixed(0)} ‡∏ø</p>
                </div>
              </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6">
              <h3 class="text-lg font-semibold mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</h3>
              ${ordersHTML}
            </div>
            
            <div class="p-4 bg-gray-100 border-t flex justify-between items-center">
              <button onclick="openGoogleSheets()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                ‡πÄ‡∏õ‡∏¥‡∏î Google Sheets
              </button>
              <div class="flex gap-2">
                <button onclick="exportUserHistory('${username}')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                  </svg>
                  ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV
                </button>
                <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                  ‡∏õ‡∏¥‡∏î
                </button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
      };
      
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô CSV
      window.exportUserHistory = function(username) {
        const orders = getUserOrderHistory(username);
        if (orders.length === 0) {
          alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å');
          return;
        }
        
        let csv = '‡∏•‡∏≥‡∏î‡∏±‡∏ö,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤,‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏£‡∏≤‡∏Ñ‡∏≤,‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°\n';
        
        orders.forEach((order, index) => {
          if (order.items && Array.isArray(order.items)) {
            order.items.forEach(item => {
              const sizeText = item.size ? ` (${item.size})` : '';
              csv += `${index + 1},"${order.timestamp || ''}","${item.name}${sizeText}",${item.qty},${item.price},${item.price * item.qty}\n`;
            });
          }
        });
        
        const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥_${username}_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        
        alert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
      };

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      window.changeUserRole = function(username, currentRole) {
        const users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        const user = users.find(u => u.username === username);
        
        if (!user) {
          alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ');
          return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (currentRole === 'admin') {
          const adminCount = users.filter(u => u.role === 'admin').length;
          if (adminCount <= 1) {
            alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ');
            return;
          }
        }

        const newRole = currentRole === 'admin' ? 'staff' : 'admin';
        const roleText = newRole === 'admin' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
        
        if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á "${username}" ‡πÄ‡∏õ‡πá‡∏ô "${roleText}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
          return;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
        const userIndex = users.findIndex(u => u.username === username);
        users[userIndex].role = newRole;
        localStorage.setItem('restaurant_users', JSON.stringify(users));
        
        alert(`‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡πá‡∏ô "${roleText}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
        loadUsers(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      };

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      window.deleteUser = function(username) {
        if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ?')) return;

        let users = JSON.parse(localStorage.getItem('restaurant_users') || '[]');
        
        // ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        const remainingAdmins = users.filter(u => u.role === 'admin' && u.username !== username);
        if (users.find(u => u.username === username)?.role === 'admin' && remainingAdmins.length === 0) {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏î‡πâ');
          return;
        }

        users = users.filter(u => u.username !== username);
        localStorage.setItem('restaurant_users', JSON.stringify(users));
        loadUsers();
        alert('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      };
    }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
    window.testLogin = function(username, password, role) {
      // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• redirect ‡πÅ‡∏•‡∏∞ session ‡πÄ‡∏Å‡πà‡∏≤
      sessionStorage.clear();
        sessionStorage.removeItem('restaurant_current_user');
      
      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö popup window
      const testWindow = window.open('index.html', 'testLogin', 
        'width=500,height=600,resizable=yes,scrollbars=yes,status=yes');
      
      if (!testWindow) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï popup window');
        return;
      }
      
      testWindow.onload = function() {
        try {
          testWindow.document.getElementById('username').value = username;
          testWindow.document.getElementById('password').value = password;
          const roleInput = testWindow.document.querySelector(`input[name="role"][value="${role}"]`);
          if (roleInput) roleInput.checked = true;
        } catch (e) {
          console.error('Error setting login form values:', e);
        }
      };
    };

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    window.addEventListener('load', function() {
      initializeUserManagement();
      
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ online ‡∏Ç‡∏≠‡∏á admin ‡πÄ‡∏≠‡∏á
      updateAdminOnlineStatus();
      setInterval(updateAdminOnlineStatus, 10000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      
      // ‡πÄ‡∏£‡∏¥‡πà‡∏° real-time updates ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets)
      console.log('üöÄ Starting background Sheets sync...');
      fetchOnlineUsersFromSheets(); // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      setInterval(() => {
        console.log('üîÑ Background: Fetching from Sheets...');
        fetchOnlineUsersFromSheets();
      }, 10000); // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    });
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ online ‡∏Ç‡∏≠‡∏á Admin
    async function updateAdminOnlineStatus() {
      const currentUser = getCurrentUser();
      if (currentUser) {
        const now = Date.now();
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï last_login
        localStorage.setItem(`last_login_${currentUser.username}`, now.toString());
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï online_users
        const onlineUsers = JSON.parse(localStorage.getItem('online_users') || '[]');
        const filteredUsers = onlineUsers.filter(u => u.username !== currentUser.username);
        filteredUsers.push({
          username: currentUser.username,
          role: currentUser.role,
          lastActive: now,
          loginTime: onlineUsers.find(u => u.username === currentUser.username)?.loginTime || now
        });
        
        // ‡∏•‡∏ö user ‡∏ó‡∏µ‡πà offline ‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ô‡∏≤‡∏ó‡∏µ
        const activeUsers = filteredUsers.filter(u => (now - u.lastActive) < 120000);
        localStorage.setItem('online_users', JSON.stringify(activeUsers));
        
        console.log(`üîÑ Admin status updated: ${currentUser.username}`);
        
        // ‡∏™‡πà‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets (‡∏õ‡∏¥‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏û‡∏£‡∏≤‡∏∞ CORS issue ‡∏ö‡∏ô localhost)
        // Uncomment ‡πÄ‡∏°‡∏∑‡πà‡∏≠ deploy ‡∏Ç‡∏∂‡πâ‡∏ô web server ‡∏à‡∏£‡∏¥‡∏á
        /*
        if (WEB_APP_URL && !WEB_APP_URL.includes('REPLACE_WITH_YOUR_WEB_APP_URL')) {
          try {
            let browserId = localStorage.getItem('browser_id');
            if (!browserId) {
              browserId = 'browser_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
              localStorage.setItem('browser_id', browserId);
            }
            
            const response = await fetch(WEB_APP_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                action: 'updateOnlineStatus',
                username: currentUser.username,
                role: currentUser.role,
                browser: browserId
              })
            });
            
            if (response.ok) {
              console.log(`‚úÖ Synced admin status to Sheets: ${currentUser.username}`);
            }
          } catch (error) {
            console.log('Could not sync admin to Sheets:', error.message);
          }
        }
        */
      }
    }
    
    // ========== Real-time Status Updates ==========
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á localStorage (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ user login/logout)
    window.addEventListener('storage', function(e) {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á online_users ‡∏´‡∏£‡∏∑‡∏≠ last_login
      if (e.key && (e.key === 'online_users' || e.key.startsWith('last_login_'))) {
        console.log('üîî ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        const usersSection = document.getElementById('usersSection');
        if (usersSection && !usersSection.classList.contains('hidden')) {
          loadUsers();
          
          // ‡πÅ‡∏™‡∏î‡∏á notification
          showStatusNotification('‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
        }
      }
    });
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á notification
    function showStatusNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in';
      notification.innerHTML = `
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>${message}</span>
        </div>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.3s';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö animation
    const realtimeStyle = document.createElement('style');
    realtimeStyle.textContent = `
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.3s ease-out;
      }
    `;
    document.head.appendChild(realtimeStyle);

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô editUser ‡πÅ‡∏•‡∏∞ deleteUser ‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô initializeUserManagement ‡πÅ‡∏•‡πâ‡∏ß
    // (‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô)

    // ---------- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ----------
    function renderHistory(){
      const historyContainer = document.getElementById("historyContainer");
      historyContainer.innerHTML = "";
      if(completedOrders.length === 0){
        historyContainer.innerHTML = `<p class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>`;
        return;
      }

      completedOrders.forEach((order, index) => {
        let itemsHtml = "";
        order.items.forEach(item => {
          const sizeText = item.size ? ` (${item.size})` : "";
          itemsHtml += `<li>${item.name}${sizeText} x${item.qty} = ${item.price * item.qty} ‡∏ö‡∏≤‡∏ó</li>`;
        });
        historyContainer.innerHTML += `
        <div class="border-b pb-2 mb-2">
          <p class="font-semibold">üßæ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${index + 1} - ${order.timestamp}</p>
          <ul class="ml-4 list-disc">${itemsHtml}</ul>
          <p class="font-bold mt-1">‡∏£‡∏ß‡∏°: ${order.total} ‡∏ö‡∏≤‡∏ó</p>
        </div>
      `;
    });
  }

    // ---------- Sidebar + Logout ----------
  // use logout() from auth.js which clears current user and redirects
    function toggleSidebar(){
      const sidebar=document.getElementById("sidebar");
      sidebar.classList.toggle("sidebar-collapsed");
      sidebar.classList.toggle("w-16");
      sidebar.classList.toggle("w-64");
      if(sidebar.classList.contains("w-16")){
        orderSummary.style.left="4rem"; orderSummary.style.width="calc(100% - 4rem)";
      } else {
        orderSummary.style.left="16rem"; orderSummary.style.width="calc(100% - 16rem)";
      }
    }
    function showSection(section){
      // ‡∏´‡∏¢‡∏∏‡∏î real-time updates ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤
      if (typeof stopRealTimeUpdates === 'function') {
        stopRealTimeUpdates();
      }
      
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å section
      document.getElementById("menuSection").classList.add("hidden");
      document.getElementById("orderSection").classList.add("hidden");
      document.getElementById("reportSection").classList.add("hidden");
      document.getElementById("historySection").classList.add("hidden");
      document.getElementById("usersSection").classList.add("hidden");
      
      // ‡πÅ‡∏™‡∏î‡∏á section ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      if(section==="menu") document.getElementById("menuSection").classList.remove("hidden");
      if(section==="order") document.getElementById("orderSection").classList.remove("hidden");
      if(section==="report") document.getElementById("reportSection").classList.remove("hidden");
      if(section==="history"){ 
        document.getElementById("historySection").classList.remove("hidden");
        renderHistory(); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
      }
      if(section==="users") {
        console.log('Showing users section');
        document.getElementById("usersSection").classList.remove("hidden");
        if(typeof loadUsers === 'function') {
          console.log('loadUsers function exists, calling it');
          loadUsers();
          
          // ‡πÄ‡∏£‡∏¥‡πà‡∏° real-time updates
          if (typeof startRealTimeUpdates === 'function') {
            startRealTimeUpdates();
            console.log('‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏° Real-time updates');
          }
        } else {
          console.error('loadUsers function not found! Check if auth.js is loaded correctly');
        }
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const users = getUsers();
        console.log('Current users:', users);
      }
    }
    updateReport();
  </script>
</body>
</html>
