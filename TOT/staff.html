<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏´‡∏ô‡πâ‡∏≤ Staff - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="auth.js"></script>
</head>
<body class="bg-gray-100">

  <!-- Navbar -->
  <nav class="bg-indigo-600 text-white p-4">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-xl font-semibold">üç± ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h1>
        <p class="text-sm opacity-80 mt-1" id="menuInfo">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π...</p>
      </div>
      <div class="flex gap-2">
        <button onclick="loadMenuFromStorage(true)" class="bg-green-500 px-4 py-2 rounded-lg hover:bg-green-600 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π
        </button>
        <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded-lg hover:bg-red-600">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </div>
  </nav>

  <!-- Menu Section -->
  <div class="max-w-6xl mx-auto mt-6 p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    <!-- ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
  </div>

  <!-- Order Summary -->
  <div id="orderSummary" class="fixed bottom-0 left-0 w-full bg-white shadow-md border-t border-gray-200 p-4 hidden">
    <h2 class="text-lg font-semibold mb-2">üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
    <ul id="orderList" class="text-gray-700 mb-2"></ul>
    <p class="font-semibold">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</p>
    <button onclick="submitOrder()" class="mt-2 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
  </div>

  <script>
    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å localStorage (‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Å‡∏±‡∏ö Admin)
    let menuItems = [];
    let lastMenuUpdateTime = null;
    
    function loadMenuFromStorage(showNotification = false) {
      const savedMenu = localStorage.getItem("menuData");
      const previousCount = menuItems.length;
      
      if (savedMenu) {
        menuItems = JSON.parse(savedMenu);
        lastMenuUpdateTime = new Date().toLocaleString();
      } else {
        // ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        menuItems = [
          { id: 1, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÄ‡∏•‡πá‡∏Å", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
          { id: 2, name: "‡∏õ‡∏µ‡∏Å‡πÑ‡∏Å‡πà", price: 15, img: "https://cdn-icons-png.flaticon.com/512/2921/2921822.png" },
          { id: 3, name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà‡πÉ‡∏´‡∏ç‡πà", price: 29, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" },
          { id: 4, name: "‡πÑ‡∏Å‡πà‡πÑ‡∏£‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å", price: 12, img: "https://cdn-icons-png.flaticon.com/512/2921/2921825.png" },
          { id: 5, name: "‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÑ‡∏Å‡πà", price: 39, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" },
          { id: 6, name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏Å‡πà‡∏ó‡∏≠‡∏î‡πÄ‡∏Å‡πä‡∏≤", price: 49, img: "https://cdn-icons-png.flaticon.com/512/2921/2921819.png" }
        ];
      }
      
      renderMenu();
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°
      if (showNotification) {
        const currentCount = menuItems.length;
        const changeText = currentCount !== previousCount 
          ? ` (${previousCount} ‚Üí ${currentCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)` 
          : '';
        showToast(`‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à${changeText}`, 'success');
      }
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Toast Notification
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 animate-fade-in ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        'bg-blue-500'
      }`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    const menuContainer = document.querySelector(".grid");
    const orderSummary = document.getElementById("orderSummary");
    const orderList = document.getElementById("orderList");
    const totalDisplay = document.getElementById("total");

    let order = [];

    // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    function renderMenu() {
      menuContainer.innerHTML = "";
      
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà navbar
      const menuInfo = document.getElementById('menuInfo');
      if (menuInfo) {
        menuInfo.textContent = `‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${menuItems.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£${lastMenuUpdateTime ? ' | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + lastMenuUpdateTime : ''}`;
      }
      
      if (menuItems.length === 0) {
        menuContainer.innerHTML = `
          <div class="col-span-full text-center py-12">
            <p class="text-gray-500 text-lg mb-4">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
            <button onclick="loadMenuFromStorage(true)" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
              üîÑ ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà
            </button>
          </div>
        `;
        return;
      }

      menuItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-xl shadow-md p-4 flex flex-col items-center hover:shadow-lg transition";
        const sizeText = item.size ? ` (${item.size})` : "";
        card.innerHTML = `
          <img src="${item.img}" alt="${item.name}" class="w-24 h-24 mb-3 object-cover rounded">
          <h2 class="font-semibold text-center">${item.name}${sizeText}</h2>
          <p class="text-gray-600 mb-3">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addToOrder(${item.id})">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        `;
        menuContainer.appendChild(card);
      });
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    loadMenuFromStorage();

    // ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á localStorage (‡πÄ‡∏°‡∏∑‡πà‡∏≠ Admin ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏ô‡∏π - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô)
    window.addEventListener('storage', function(e) {
      if (e.key === 'menuData') {
        console.log('‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å Admin (‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô)');
        loadMenuFromStorage();
        showToast('üîî ‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏î‡∏¢ Admin', 'info');
      }
    });

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
    let lastMenuHash = JSON.stringify(menuItems);
    setInterval(function() {
      const savedMenu = localStorage.getItem("menuData");
      if (savedMenu) {
        const currentHash = savedMenu;
        if (currentHash !== lastMenuHash) {
          console.log('üîÑ ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏°‡∏ô‡∏π - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...');
          lastMenuHash = currentHash;
          loadMenuFromStorage();
          showToast('üîî ‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß!', 'success');
        }
      }
    }, 2000); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.3s ease-out;
      }
    `;
    document.head.appendChild(style);

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£
    function addToOrder(id) {
      const item = menuItems.find(i => i.id === id);
      const existing = order.find(o => o.id === id);
      if (existing) {
        existing.qty++;
      } else {
        order.push({ ...item, qty: 1 });
      }
      updateOrderSummary();
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
    function updateOrderSummary() {
      orderList.innerHTML = "";
      let total = 0;
      order.forEach(item => {
        total += item.price * item.qty;
        orderList.innerHTML += `
          <li class="flex justify-between items-center mb-1">
            ${item.name} x${item.qty}
            <button onclick="removeItem(${item.id})" class="text-red-500 ml-2">‚úï</button>
          </li>
        `;
      });
      totalDisplay.textContent = total;
      orderSummary.classList.toggle("hidden", order.length === 0);
    }

    // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    function removeItem(id) {
      order = order.filter(i => i.id !== id);
      updateOrderSummary();
    }

    // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡∏ú‡πà‡∏≤‡∏ô Google Apps Script Web App
    // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡∏™‡∏£‡πâ‡∏≤‡∏á Apps Script (‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á), Deploy as Web app
    // ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤ URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ WEB_APP_URL ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    const WEB_APP_URL = "REPLACE_WITH_YOUR_WEB_APP_URL"; // <-- ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    async function submitOrder() {
      if (order.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£");

      const orderData = {
        action: 'createPending',
        timestamp: new Date().toLocaleString(),
        items: order,
        total: totalDisplay.textContent,
        orderedBy: currentUser ? (currentUser.name || currentUser.username) : '',
        username: currentUser ? currentUser.username : ''
      };

      try {
        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö POST ‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Apps Script Web App
        const res = await fetch(WEB_APP_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(orderData)
        });

        if (!res.ok) {
          const body = await res.text().catch(() => null);
          debugLog('Response not ok: ' + res.status + ' ' + body);
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets (HTTP " + res.status + ")");
          return;
        }

        const json = await res.json().catch(() => null);
        debugLog('‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Web App: ' + JSON.stringify(json));
        alert("‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");

        // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        order = [];
        updateOrderSummary();
      } catch (err) {
        debugLog('‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err);
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets ‡πÑ‡∏î‡πâ ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL/‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web App ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á");
      }
    }

    // `logout()` is provided by `auth.js` (it clears current user and redirects)
  </script>
</body>
</html>
